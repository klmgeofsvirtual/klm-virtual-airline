<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>KLM Virtual Airline | Operations Center</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    
    <!-- Leaflet Map CSS -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"/>

    <style>
        /* KLM Brand Colors */
        :root {
            --klm-blue: #00A1DE; 
            --klm-dark: #0077A3;
            --klm-sky: #E5F6FF;
            --discord: #5865F2;
            --discord-dark: #4752C4;
        }
        
        .text-klm { color: var(--klm-blue); }
        .bg-klm { background-color: var(--klm-blue); }
        .bg-klm-dark { background-color: var(--klm-dark); }
        .hover-bg-klm:hover { background-color: var(--klm-dark); }
        .bg-discord { background-color: var(--discord); }
        .hover-bg-discord:hover { background-color: var(--discord-dark); }
        
        body { font-family: 'Segoe UI', Roboto, Helvetica, Arial, sans-serif; }

        /* Custom Scrollbar */
        ::-webkit-scrollbar { width: 6px; }
        ::-webkit-scrollbar-track { background: #0f172a; }
        ::-webkit-scrollbar-thumb { background: #334155; border-radius: 3px; }
        ::-webkit-scrollbar-thumb:hover { background: #475569; }

        /* Animations */
        .fade-in { animation: fadeIn 0.4s ease-in-out; }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* Nav Active State */
        .nav-link.active {
            color: var(--klm-blue);
            font-weight: 700;
        }
        .nav-link.active::after {
            content: '';
            display: block;
            width: 100%;
            height: 2px;
            background: var(--klm-blue);
            margin-top: 2px;
        }

        /* Epaulettes */
        .epaulette {
            background: #1e293b;
            width: 60px;
            height: 80px;
            border-radius: 4px 4px 20px 20px;
            display: flex;
            flex-direction: column;
            justify-content: flex-end;
            align-items: center;
            padding-bottom: 10px;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.3);
        }
        .stripe {
            width: 80%;
            height: 6px;
            background: #eab308;
            margin-top: 4px;
        }

        /* Map Styles */
        #fleet-map {
            width: 100%;
            height: 600px;
            background: #0f172a;
            z-index: 1;
        }

        /* Dispatch Board Styles */
        .fids-board {
            font-family: 'Courier New', Courier, monospace;
            background: #0f172a;
            border: 1px solid #334155;
            border-radius: 8px;
            overflow: hidden;
            position: relative;
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.5);
        }
        .fids-header {
            background: #1e293b;
            color: #94a3b8;
            font-weight: bold;
            padding: 12px 16px;
            display: grid;
            grid-template-columns: 1.5fr 1fr 1fr 1.5fr 1fr 1fr;
            text-transform: uppercase;
            font-size: 0.7rem;
            letter-spacing: 1.5px;
            border-bottom: 2px solid #334155;
        }
        .fids-row {
            padding: 14px 16px;
            display: grid;
            grid-template-columns: 1.5fr 1fr 1fr 1.5fr 1fr 1fr;
            color: #e2e8f0;
            border-bottom: 1px solid #1e293b;
            font-size: 0.85rem;
            align-items: center;
            transition: background-color 0.2s;
        }
        .fids-row:hover { background-color: #1e293b; }
        .fids-row:last-child { border-bottom: none; }
        
        #dispatch-rows {
            max-height: 300px; /* Approximately 5-6 rows */
            overflow-y: auto;
        }

        /* News Card Styles */
        .news-card {
            transition: transform 0.2s, box-shadow 0.2s;
        }
        .news-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.3);
        }
        
        /* Mourning Ribbon */
        .ribbon {
            background: #000;
            color: #fff;
            text-align: center;
            font-size: 0.75rem;
            font-weight: bold;
            text-transform: uppercase;
            letter-spacing: 0.1em;
            padding: 8px 0;
            position: sticky;
            top: 0;
            z-index: 60;
        }
    </style>
</head>
<body class="bg-slate-50 text-slate-800 flex flex-col min-h-screen">

    <!-- MOURNING RIBBON -->
    <div class="ribbon">
        <span class="opacity-75 mr-2">●</span> In Memoriam: Flight KLM1016 <span class="opacity-75 ml-2">●</span>
    </div>

    <!-- ERROR BANNER (Hidden by default) -->
    <div id="db-error-banner" class="hidden bg-red-600 text-white px-4 py-3 text-center shadow-lg z-[100]">
        <div class="flex items-center justify-center gap-2">
            <i data-lucide="alert-triangle" class="w-5 h-5"></i>
            <span class="font-bold">DATABASE ERROR:</span>
            <span class="text-sm">Connection lost or database not found.</span>
            <a href="https://console.cloud.google.com/datastore/setup?project=klm-dispatch" target="_blank" class="underline font-bold hover:text-red-200 ml-2">Fix in Console</a>
        </div>
    </div>

    <!-- Navigation -->
    <nav class="sticky top-[34px] z-50 bg-white/95 backdrop-blur-md shadow-sm border-b border-slate-200">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between h-20">
                <div class="flex items-center cursor-pointer" onclick="router('home')">
                    <img id="nav-logo" src="" alt="KLM Logo" class="h-8 md:h-10 mr-3">
                    <div class="hidden md:flex flex-col leading-tight border-l border-slate-300 pl-3 ml-2">
                        <span class="font-bold text-slate-900 text-sm tracking-wide">OPERATIONS</span>
                        <span class="text-xs text-slate-500 uppercase tracking-widest">Center</span>
                    </div>
                </div>

                <!-- Desktop Menu -->
                <div class="hidden md:flex items-center space-x-6 lg:space-x-8">
                    <button onclick="router('home')" class="nav-link text-slate-600 hover:text-klm transition-colors font-medium py-2">Ops Center</button>
                    <button onclick="router('condolences')" class="nav-link text-slate-600 hover:text-klm transition-colors font-medium py-2">Condolences</button>
                    <button onclick="router('news')" class="nav-link text-slate-600 hover:text-klm transition-colors font-medium py-2">News</button>
                    <button onclick="router('booking')" class="nav-link text-slate-600 hover:text-klm transition-colors font-medium py-2">Dispatch</button>
                    <button onclick="router('fleet')" class="nav-link text-slate-600 hover:text-klm transition-colors font-medium py-2">Fleet</button>
                    <button onclick="router('routes')" class="nav-link text-slate-600 hover:text-klm transition-colors font-medium py-2">Network</button>
                    <button onclick="router('livemap')" class="nav-link text-slate-600 hover:text-klm transition-colors font-medium py-2">Live Map</button>
                    <button onclick="router('community')" class="nav-link text-slate-600 hover:text-klm transition-colors font-medium py-2">Crew</button>
                    
                    <a href="https://discord.gg/vRzmhuEmBQ" target="_blank" class="bg-slate-900 text-white px-5 py-2 rounded font-bold hover:bg-slate-800 transition shadow flex items-center text-sm uppercase tracking-wide">
                        <i data-lucide="radio" class="w-4 h-4 mr-2"></i> Report In
                    </a>
                </div>

                <div class="md:hidden flex items-center">
                    <button onclick="toggleMobileMenu()" class="text-slate-600 hover:text-klm focus:outline-none p-2">
                        <i data-lucide="menu" class="h-7 w-7"></i>
                    </button>
                </div>
            </div>
        </div>
        <!-- Mobile Menu -->
        <div id="mobile-menu" class="hidden md:hidden bg-white border-t border-slate-100 shadow-xl absolute w-full left-0 z-40">
            <div class="p-4 space-y-2">
                <button onclick="router('home'); toggleMobileMenu()" class="block w-full text-left px-4 py-3 rounded hover:bg-slate-50 font-bold text-slate-800">Ops Center</button>
                <button onclick="router('condolences'); toggleMobileMenu()" class="block w-full text-left px-4 py-3 rounded hover:bg-slate-50 font-bold text-slate-800">Condolences</button>
                <button onclick="router('news'); toggleMobileMenu()" class="block w-full text-left px-4 py-3 rounded hover:bg-slate-50 font-medium text-slate-600">News</button>
                <button onclick="router('booking'); toggleMobileMenu()" class="block w-full text-left px-4 py-3 rounded hover:bg-slate-50 font-medium text-slate-600">Dispatch</button>
                <button onclick="router('fleet'); toggleMobileMenu()" class="block w-full text-left px-4 py-3 rounded hover:bg-slate-50 font-medium text-slate-600">Fleet</button>
                <button onclick="router('routes'); toggleMobileMenu()" class="block w-full text-left px-4 py-3 rounded hover:bg-slate-50 font-medium text-slate-600">Network</button>
                <button onclick="router('livemap'); toggleMobileMenu()" class="block w-full text-left px-4 py-3 rounded hover:bg-slate-50 font-medium text-slate-600">Live Map</button>
                <button onclick="router('community'); toggleMobileMenu()" class="block w-full text-left px-4 py-3 rounded hover:bg-slate-50 font-medium text-slate-600">Crew</button>
            </div>
        </div>
    </nav>

    <main id="app-content" class="flex-grow"></main>

    <footer class="bg-slate-900 text-slate-400 py-12 border-t border-slate-800">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="grid grid-cols-1 md:grid-cols-4 gap-8 mb-8 border-b border-slate-800 pb-8">
                <div class="col-span-1 md:col-span-2">
                    <img id="footer-logo" src="" alt="KLM Logo" class="h-8 mb-4 brightness-0 invert opacity-80">
                    <p class="text-sm leading-relaxed max-w-sm text-slate-500">
                        A non-profit virtual aviation community. We are not affiliated with KLM Royal Dutch Airlines.
                        <br><br>
                        <strong>Operations Hub:</strong> Amsterdam Airport Schiphol (EHAM)
                    </p>
                </div>
                <div>
                    <h4 class="text-white font-bold mb-4 uppercase text-xs tracking-wider">Flight Operations</h4>
                    <ul class="space-y-2 text-sm">
                        <li><button onclick="router('sop')" class="hover:text-white transition">Standard Operating Procedures</button></li>
                        <li><button onclick="router('fleet')" class="hover:text-white transition">Fleet Manifest</button></li>
                        <li><button onclick="router('routes')" class="hover:text-white transition">Network Map</button></li>
                    </ul>
                </div>
                <div>
                    <h4 class="text-white font-bold mb-4 uppercase text-xs tracking-wider">Command Staff</h4>
                    <ul class="space-y-2 text-sm font-mono">
                        <li>mileflight <span class="text-xs text-slate-600">// CEO</span></li>
                        <li>JustFrost <span class="text-xs text-slate-600">// Temp CEO</span></li>
                        <li>Nihid9044 <span class="text-xs text-slate-600">// CMO</span></li>
                    </ul>
                </div>
            </div>
            <div class="text-center md:text-left text-xs text-slate-600">
                &copy; 2026 KLM Virtual Airline. "Flying the World, Virtually."
            </div>
        </div>
    </footer>

    <!-- Leaflet Script (Non-module) -->
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

    <!-- MAIN APP SCRIPT (MODULE) -->
    <script type="module">
        // Import Modern Firebase SDK
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getFirestore, collection, addDoc, onSnapshot, orderBy, query, limit, serverTimestamp, doc, updateDoc, increment, setDoc, getDoc } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";
        import { getAnalytics } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-analytics.js";

        // ==========================================
        //  FIREBASE CONFIGURATION
        // ==========================================
        const firebaseConfig = {
            apiKey: "AIzaSyBNM1Xc7a64GIlOiBiwJ5hE9Ci6EK1lxuo",
            authDomain: "klm-dispatch.firebaseapp.com",
            projectId: "klm-dispatch",
            storageBucket: "klm-dispatch.firebasestorage.app",
            messagingSenderId: "805612664938",
            appId: "1:805612664938:web:7a794aaaa0c184dcf6f213",
            measurementId: "G-6QQH3YVRKW"
        };
        
        // ==========================================
        //  DISCORD CONFIGURATION
        // ==========================================
        const REQUIRED_GUILD_ID = "1432591913915125824"; 

        // Initialize Firebase
        let db;
        try {
            const app = initializeApp(firebaseConfig);
            db = getFirestore(app);
            const analytics = getAnalytics(app);
            console.log("Firebase initialized successfully (Modular SDK)");
        } catch (e) {
            console.error("Firebase Initialization Error:", e);
        }

        // --- GLOBAL CONSTANTS ---
        const siteImages = {
            logo: "https://upload.wikimedia.org/wikipedia/commons/c/c7/KLM_logo.svg",
            homeHero: "https://content.r9cdn.net/rimg/dimg/aa/3f/bf32fc29-al-KL-168342f6d92.jpg?width=1366&height=768&xhint=1075&yhint=770&crop=true"
        };
        
        // --- AUTHENTICATION STATE ---
        let discordUser = null; 
        
        // --- LOGOUT / RESET FUNCTION ---
        window.doLogout = () => {
            localStorage.removeItem('klm_discord_user');
            window.location.reload();
        };

        // --- CHECK FOR DISCORD REDIRECT ---
        function checkDiscordAuth() {
            const fragment = new URLSearchParams(window.location.hash.slice(1));
            const accessToken = fragment.get('access_token');
            const tokenType = fragment.get('token_type');

            if (accessToken) {
                window.history.replaceState({}, document.title, window.location.pathname);
                
                // 1. Fetch User Profile
                fetch('https://discord.com/api/users/@me', {
                    headers: { authorization: `${tokenType} ${accessToken}` }
                })
                .then(res => res.json())
                .then(user => {
                    // 2. Fetch User Guilds (Servers)
                    return fetch('https://discord.com/api/users/@me/guilds', {
                        headers: { authorization: `${tokenType} ${accessToken}` }
                    })
                    .then(res => res.json())
                    .then(guilds => {
                        // 3. Check if user is in the required server
                        const isMember = Array.isArray(guilds) && guilds.some(g => g.id === REQUIRED_GUILD_ID);
                        
                        const userData = { ...user, isMember: isMember };
                        
                        // Save to storage
                        localStorage.setItem('klm_discord_user', JSON.stringify(userData));
                        discordUser = userData;
                        
                        if(document.getElementById('login-section')) {
                            initBookingPage(); 
                        }
                    });
                })
                .catch(console.error);
            } else {
                const stored = localStorage.getItem('klm_discord_user');
                if (stored) {
                    discordUser = JSON.parse(stored);
                }
            }
        }
        
        checkDiscordAuth();

        const fleetData = [
            { type: "Embraer 190", icao: "E190", role: "Cityhopper", desc: "Short-haul, high-frequency ops for training and local connectivity.", status: "Active", count: 21, img: "https://upload.wikimedia.org/wikipedia/commons/c/c6/Berlin_Brandenburg_Airport_KLM_Cityhopper_Embraer_E195-E2_PH-NXC_%28DSC02878%29.jpg" },
            { type: "Embraer 195-E2", icao: "E295", role: "Cityhopper", desc: "Modern regional efficiency. High frequency European connections.", status: "Active", count: 25, img: "https://img.static-kl.com/transform/53cea398-7cff-4e3f-a7b1-496d4552fb10/" },
            { type: "Boeing 737-700 LTRP", icao: "B737", role: "Short Haul", desc: "Legacy workhorse receiving extended-life refurbishment under LTRP program.", status: "LTRP", count: 6, img: "https://upload.wikimedia.org/wikipedia/commons/thumb/3/34/KLM_Boeing_737-7K2_PH-BGT_MUC_2015_01.jpg/1280px-KLM_Boeing_737-7K2_PH-BGT_MUC_2015_01.jpg" },
            { type: "Boeing 737-800", icao: "B738", role: "Short Haul", desc: "Backbone of European operations. Gradual retirement scheduled.", status: "Phasing Out", count: 30, img: "https://upload.wikimedia.org/wikipedia/commons/1/18/KLM_Boeing_737-800_PH-BCD_%2826038861623%29.jpg" },
            { type: "Airbus A320neo", icao: "A20N", role: "Short Haul", desc: "Next-gen European core. Maximum efficiency and realism.", status: "Active", count: 9, img: "https://image.parool.nl/211007987/width/2480/impressie-van-een-airbus-a320-neo-in-de-kleuren-van-klm" },
            { type: "Airbus A321neo", icao: "A21N", role: "Short Haul", desc: "High-capacity European routes. Primary replacement for B737.", status: "Active", count: 22, img: "https://img.static-kl.com/transform/8806738a-a661-4934-a177-95adef39307d/" },
            { type: "Airbus A330-200", icao: "A332", role: "Medium Haul", desc: "Intercontinental connector. Scheduled for retirement.", status: "Phasing Out", count: 6, img: "https://cdn.flightsim.to/images/27/inibuilds-a330-300-klm-fleet-pack-55321-1735741086-uIy_G.jpg?width=1400" },
            { type: "Boeing 777-300ER LTRP", icao: "B77W", role: "Long Haul", desc: "Reinforced and refurbished for reliable service until next-gen replacement.", status: "LTRP", count: 3, img: "https://www.aerotime.aero/images/klm_boeing_777-300er_orange_pride_livery.jpg" },
            { type: "Boeing 787-9", icao: "B789", role: "Long Haul", desc: "The future of our long-haul operations. Elite flagship.", status: "Active", count: 13, img: "https://content.presspage.com/uploads/162/1920_25508202-10155250600310773-6357422191407278812-n.jpg" },
            { type: "Boeing 787-10", icao: "B78X", role: "Long Haul", desc: "High-capacity Dreamliner for premium long-haul routes.", status: "Active", count: 14, img: "https://content.presspage.com/uploads/162/1920_paulridderhof30jun196473-465547.jpg?10000" },
        ];

        const routeData = {
            "Europe": [
                { city: "London Heathrow", code: "EGLL", out: "KL1006, KL1007, KL1008, KL1009, KL1010", in: "KL1001, KL1002, KL1003, KL1004, KL1005" },
                { city: "Paris CDG", code: "LFPG", out: "KL1016, KL1017, KL1018, KL1019, KL1020", in: "KL1011, KL1012, KL1013, KL1014, KL1015" },
                { city: "Berlin", code: "EDDB", out: "KL1026, KL1027, KL1028, KL1029, KL1030", in: "KL1021, KL1022, KL1023, KL1024, KL1025" },
                { city: "Rome", code: "LIRF", out: "KL1036, KL1037, KL1038, KL1039, KL1040", in: "KL1031, KL1032, KL1033, KL1034, KL1035" },
                { city: "Madrid", code: "LEMD", out: "KL1046, KL1047, KL1048, KL1049, KL1050", in: "KL1041, KL1042, KL1043, KL1044, KL1045" },
                { city: "Vienna", code: "LOWW", out: "KL1056, KL1057, KL1058, KL1059, KL1060", in: "KL1051, KL1052, KL1053, KL1054, KL1055" },
                { city: "Brussels", code: "EBBR", out: "KL1066, KL1067, KL1068, KL1069, KL1070", in: "KL1061, KL1062, KL1063, KL1064, KL1065" },
                { city: "Zurich", code: "LSZH", out: "KL1076, KL1077, KL1078, KL1079, KL1080", in: "KL1071, KL1072, KL1073, KL1074, KL1075" },
                { city: "Geneva", code: "LSGG", out: "KL1086, KL1087, KL1088, KL1089, KL1090", in: "KL1081, KL1082, KL1083, KL1084, KL1085" },
                { city: "Stockholm", code: "ESSA", out: "KL1096, KL1097, KL1098, KL1099, KL1100", in: "KL1091, KL1092, KL1093, KL1094, KL1095" },
                { city: "Copenhagen", code: "EKCH", out: "KL1106, KL1107, KL1108, KL1109, KL1110", in: "KL1101, KL1102, KL1103, KL1104, KL1105" },
                { city: "Oslo", code: "ENGM", out: "KL1116, KL1117, KL1118, KL1119, KL1120", in: "KL1111, KL1112, KL1113, KL1114, KL1115" },
                { city: "Helsinki", code: "EFHK", out: "KL1126, KL1127, KL1128, KL1129, KL1130", in: "KL1121, KL1122, KL1123, KL1124, KL1125" },
                { city: "Riga", code: "EVRA", out: "KL1136, KL1137, KL1138, KL1139, KL1140", in: "KL1131, KL1132, KL1133, KL1134, KL1135" },
                { city: "Tallinn", code: "EETN", out: "KL1146, KL1147, KL1148, KL1149, KL1150", in: "KL1141, KL1142, KL1143, KL1144, KL1145" },
                { city: "Vilnius", code: "EYVI", out: "KL1156, KL1157, KL1158, KL1159, KL1160", in: "KL1151, KL1152, KL1153, KL1154, KL1155" },
                { city: "Porto", code: "LPPR", out: "KL1166, KL1167, KL1168, KL1169, KL1170", in: "KL1161, KL1162, KL1163, KL1164, KL1165" },
                { city: "Lisbon", code: "LPPT", out: "KL1176, KL1177, KL1178, KL1179, KL1180", in: "KL1171, KL1172, KL1173, KL1174, KL1175" },
                { city: "Kraków", code: "EPKK", out: "KL1186, KL1187, KL1188, KL1189, KL1190", in: "KL1181, KL1182, KL1183, KL1184, KL1185" },
                { city: "Warsaw", code: "EPWA", out: "KL1196, KL1197, KL1198, KL1199, KL1200", in: "KL1191, KL1192, KL1193, KL1194, KL1195" },
                { city: "Prague", code: "LKPR", out: "KL1206, KL1207, KL1208, KL1209, KL1210", in: "KL1201, KL1202, KL1203, KL1204, KL1205" },
                { city: "Budapest", code: "LHBP", out: "KL1216, KL1217, KL1218, KL1219, KL1220", in: "KL1211, KL1212, KL1213, KL1214, KL1215" },
                { city: "Bucharest", code: "LROP", out: "KL1226, KL1227, KL1228, KL1229, KL1230", in: "KL1221, KL1222, KL1223, KL1224, KL1225" },
                { city: "Marseille", code: "LFML", out: "KL1236, KL1237, KL1238, KL1239, KL1240", in: "KL1231, KL1232, KL1233, KL1234, KL1235" },
                { city: "Nice", code: "LFMN", out: "KL1246, KL1247, KL1248, KL1249, KL1250", in: "KL1241, KL1242, KL1243, KL1244, KL1245" },
                { city: "Athens", code: "LGAV", out: "KL1256, KL1257, KL1258, KL1259, KL1260", in: "KL1251, KL1252, KL1253, KL1254, KL1255" }
            ],
            "North America": [
                 { city: "New York JFK", code: "KJFK", out: "KL2006, KL2007, KL2008, KL2009, KL2010", in: "KL2001, KL2002, KL2003, KL2004, KL2005" },
                 { city: "Atlanta", code: "KATL", out: "KL2016, KL2017, KL2018, KL2019, KL2020", in: "KL2011, KL2012, KL2013, KL2014, KL2015" },
                 { city: "Los Angeles", code: "KLAX", out: "KL2026, KL2027, KL2028, KL2029, KL2030", in: "KL2021, KL2022, KL2023, KL2024, KL2025" },
                 { city: "San Francisco", code: "KSFO", out: "KL2036, KL2037, KL2038, KL2039, KL2040", in: "KL2031, KL2032, KL2033, KL2034, KL2035" },
                 { city: "Chicago", code: "KORD", out: "KL2046, KL2047, KL2048, KL2049, KL2050", in: "KL2041, KL2042, KL2043, KL2044, KL2045" },
                 { city: "Washington", code: "KIAD", out: "KL2056, KL2057, KL2058, KL2059, KL2060", in: "KL2051, KL2052, KL2053, KL2054, KL2055" },
                 { city: "Boston", code: "KBOS", out: "KL2066, KL2067, KL2068, KL2069, KL2070", in: "KL2061, KL2062, KL2063, KL2064, KL2065" },
                 { city: "Houston", code: "KIAH", out: "KL2076, KL2077, KL2078, KL2079, KL2080", in: "KL2071, KL2072, KL2073, KL2074, KL2075" },
                 { city: "Toronto", code: "CYYZ", out: "KL2086, KL2087, KL2088, KL2089, KL2090", in: "KL2081, KL2082, KL2083, KL2084, KL2085" },
                 { city: "Montreal", code: "CYUL", out: "KL2096, KL2097, KL2098, KL2099, KL2100", in: "KL2091, KL2092, KL2093, KL2094, KL2095" },
                 { city: "Calgary", code: "CYYC", out: "KL2106, KL2107, KL2108, KL2109, KL2110", in: "KL2101, KL2102, KL2103, KL2104, KL2105" },
                 { city: "Vancouver", code: "CYVR", out: "KL2116, KL2117, KL2118, KL2119, KL2120", in: "KL2111, KL2112, KL2113, KL2114, KL2115" },
                 { city: "Mexico City", code: "MMMX", out: "KL2126, KL2127, KL2128, KL2129, KL2130", in: "KL2121, KL2122, KL2123, KL2124, KL2125" }
            ],
             "South America": [
                 { city: "São Paulo", code: "SBGR", out: "KL3006, KL3007, KL3008, KL3009, KL3010", in: "KL3001, KL3002, KL3003, KL3004, KL3005" },
                 { city: "Rio de Janeiro", code: "SBGL", out: "KL3016, KL3017, KL3018, KL3019, KL3020", in: "KL3011, KL3012, KL3013, KL3014, KL3015" },
                 { city: "Buenos Aires", code: "SAEZ", out: "KL3026, KL3027, KL3028, KL3029, KL3030", in: "KL3021, KL3022, KL3023, KL3024, KL3025" },
                 { city: "Lima", code: "SPJC", out: "KL3036, KL3037, KL3038, KL3039, KL3040", in: "KL3031, KL3032, KL3033, KL3034, KL3035" },
                 { city: "Bogotá", code: "SKBO", out: "KL3046, KL3047, KL3048, KL3049, KL3050", in: "KL3041, KL3042, KL3043, KL3044, KL3045" },
                 { city: "Quito", code: "SEQM", out: "KL3056, KL3057, KL3058, KL3059, KL3060", in: "KL3051, KL3052, KL3053, KL3054, KL3055" },
                 { city: "Guayaquil", code: "SEGU", out: "KL3066, KL3067, KL3068, KL3069, KL3070", in: "KL3061, KL3062, KL3063, KL3064, KL3065" },
                 { city: "Paramaribo", code: "SMJP", out: "KL3076, KL3077, KL3078, KL3079, KL3080", in: "KL3071, KL3072, KL3073, KL3074, KL3075" },
                 { city: "Aruba", code: "TNCA", out: "KL3086, KL3087, KL3088, KL3089, KL3090", in: "KL3081, KL3082, KL3083, KL3084, KL3085" },
                 { city: "Curaçao", code: "TNCC", out: "KL3096, KL3097, KL3098, KL3099, KL3100", in: "KL3091, KL3092, KL3093, KL3094, KL3095" },
                 { city: "Bonaire", code: "TNCB", out: "KL3106, KL3107, KL3108, KL3109, KL3110", in: "KL3101, KL3102, KL3103, KL3104, KL3105" },
                 { city: "St. Maarten", code: "TNCM", out: "KL3116, KL3117, KL3118, KL3119, KL3120", in: "KL3111, KL3112, KL3113, KL3114, KL3115" }
             ],
            "Africa": [
                 { city: "Nairobi", code: "HKJK", out: "KL4006, KL4007, KL4008, KL4009, KL4010", in: "KL4001, KL4002, KL4003, KL4004, KL4005" },
                 { city: "Dar es Salaam", code: "HTDA", out: "KL4016, KL4017, KL4018, KL4019, KL4020", in: "KL4011, KL4012, KL4013, KL4014, KL4015" },
                 { city: "Johannesburg", code: "FAOR", out: "KL4026, KL4027, KL4028, KL4029, KL4030", in: "KL4021, KL4022, KL4023, KL4024, KL4025" },
                 { city: "Cape Town", code: "FACT", out: "KL4036, KL4037, KL4038, KL4039, KL4040", in: "KL4031, KL4032, KL4033, KL4034, KL4035" },
                 { city: "Accra", code: "DGAA", out: "KL4046, KL4047, KL4048, KL4049, KL4050", in: "KL4041, KL4042, KL4043, KL4044, KL4045" },
                 { city: "Lagos", code: "DNMM", out: "KL4056, KL4057, KL4058, KL4059, KL4060", in: "KL4051, KL4052, KL4053, KL4054, KL4055" },
                 { city: "Kigali", code: "HRYR", out: "KL4066, KL4067, KL4068, KL4069, KL4070", in: "KL4061, KL4062, KL4063, KL4064, KL4065" },
                 { city: "Entebbe", code: "HUEN", out: "KL4076, KL4077, KL4078, KL4079, KL4080", in: "KL4071, KL4072, KL4073, KL4074, KL4075" }
            ],
            "Asia": [
                 { city: "Delhi", code: "VIDP", out: "KL5006, KL5007, KL5008, KL5009, KL5010", in: "KL5001, KL5002, KL5003, KL5004, KL5005" },
                 { city: "Mumbai", code: "VABB", out: "KL5016, KL5017, KL5018, KL5019, KL5020", in: "KL5011, KL5012, KL5013, KL5014, KL5015" },
                 { city: "Bangalore", code: "VOBL", out: "KL5026, KL5027, KL5028, KL5029, KL5030", in: "KL5021, KL5022, KL5023, KL5024, KL5025" },
                 { city: "Beijing", code: "ZBAA", out: "KL5036, KL5037, KL5038, KL5039, KL5040", in: "KL5031, KL5032, KL5033, KL5034, KL5035" },
                 { city: "Shanghai", code: "ZSPD", out: "KL5046, KL5047, KL5048, KL5049, KL5050", in: "KL5041, KL5042, KL5043, KL5044, KL5045" },
                 { city: "Hong Kong", code: "VHHH", out: "KL5056, KL5057, KL5058, KL5059, KL5060", in: "KL5051, KL5052, KL5053, KL5054, KL5055" },
                 { city: "Tokyo Narita", code: "RJAA", out: "KL5066, KL5067, KL5068, KL5069, KL5070", in: "KL5061, KL5062, KL5063, KL5064, KL5065" },
                 { city: "Osaka Kansai", code: "RJBB", out: "KL5076, KL5077, KL5078, KL5079, KL5080", in: "KL5071, KL5072, KL5073, KL5074, KL5075" },
                 { city: "Seoul Incheon", code: "RKSI", out: "KL5086, KL5087, KL5088, KL5089, KL5090", in: "KL5081, KL5082, KL5083, KL5084, KL5085" },
                 { city: "Bangkok", code: "VTBS", out: "KL5096, KL5097, KL5098, KL5099, KL5100", in: "KL5091, KL5092, KL5093, KL5094, KL5095" },
                 { city: "Singapore", code: "WSSS", out: "KL5106, KL5107, KL5108, KL5109, KL5110", in: "KL5101, KL5102, KL5103, KL5104, KL5105" },
                 { city: "Kuala Lumpur", code: "WMKK", out: "KL5116, KL5117, KL5118, KL5119, KL5120", in: "KL5111, KL5112, KL5113, KL5114, KL5115" },
                 { city: "Jakarta", code: "WIII", out: "KL5126, KL5127, KL5128, KL5129, KL5130", in: "KL5121, KL5122, KL5123, KL5124, KL5125" },
                 { city: "Manila", code: "RPLL", out: "KL5136, KL5137, KL5138, KL5139, KL5140", in: "KL5131, KL5132, KL5133, KL5134, KL5135" },
                 { city: "Taipei", code: "RCTP", out: "KL5146, KL5147, KL5148, KL5149, KL5150", in: "KL5141, KL5142, KL5143, KL5144, KL5145" },
                 { city: "Denpasar Bali", code: "WADD", out: "KL5156, KL5157, KL5158, KL5159, KL5160", in: "KL5151, KL5152, KL5153, KL5154, KL5155" }
            ],
            "Middle East": [
                { city: "Dubai", code: "OMDB", out: "KL6006, KL6007, KL6008, KL6009, KL6010", in: "KL6001, KL6002, KL6003, KL6004, KL6005" },
                { city: "Abu Dhabi", code: "OMAA", out: "KL6016, KL6017, KL6018, KL6019, KL6020", in: "KL6011, KL6012, KL6013, KL6014, KL6015" },
                { city: "Kuwait City", code: "OKBK", out: "KL6026, KL6027, KL6028, KL6029, KL6030", in: "KL6021, KL6022, KL6023, KL6024, KL6025" },
                { city: "Doha", code: "OTHH", out: "KL6036, KL6037, KL6038, KL6039, KL6040", in: "KL6031, KL6032, KL6033, KL6034, KL6035" },
                { city: "Tel Aviv", code: "LLBG", out: "KL6046, KL6047, KL6048, KL6049, KL6050", in: "KL6041, KL6042, KL6043, KL6044, KL6045" },
                { city: "Riyadh", code: "OERK", out: "KL6056, KL6057, KL6058, KL6059, KL6060", in: "KL6051, KL6052, KL6053, KL6054, KL6055" },
                { city: "Cairo", code: "HECA", out: "KL6066, KL6067, KL6068, KL6069, KL6070", in: "KL6061, KL6062, KL6063, KL6064, KL6065" }
            ]
        };

        const newsData = [
            { date: "15 FEB 2026", title: "Flight Number and Systems Update", tag: "TECH", content: "New flight numbers have been issued across the network, accompanied by website and bot updates to support ongoing restructuring and operational improvements." },
            { date: "15 FEB 2026", title: "Dual Leadership Role Announcement", tag: "STAFF", content: "Chairperson Nihid has been appointed CEO of Qatar Airways Virtual and will balance responsibilities across both airlines. KLM Virtual Airlines remains the primary focus, with ongoing leadership and operational oversight continuing as normal." },
            { date: "11 FEB 2026", title: "Callsign Standardization Directive", tag: "OPS", content: "All pilots are required to use the callsign “KL” instead of “KLM” when operating on RadarThing to ensure standardization and realism across network operations." },
            { date: "08 FEB 2026", title: "Official Statement on Flight KLM1016 Accident", tag: "URGENT", content: "KLM Virtual Airlines confirms that Flight KLM1016, operated by an Embraer 190 from Amsterdam to London Heathrow, was involved in a fatal accident shortly after departure, resulting in the loss of all passengers and crew. We are cooperating fully with GASA investigators, preserving operational data, and conducting an immediate internal safety review. Initial compensation has been announced, and family assistance measures are being implemented." },
            { date: "03 FEB 2026", title: "Milano-Cortina Olympics Operations Boost", tag: "EVENT", content: "Flights operating to and from Milan during the Milano-Cortina Olympic Games will receive a 1.5× reward and experience multiplier for the duration of the event." },
            { date: "01 FEB 2026", title: "Long-Term Refurbishment Plan (LTRP)", tag: "FLEET", content: "We are launching the Long-Term Refurbishment Plan with a $65 million investment in remaining Boeing 737-7 and 777-300ER aircraft to extend service life. The Airbus A330-200 will be fully phased out as part of this strategy." },
            { date: "29 JAN 2026", title: "Official Widebody Delivery Dispatch", tag: "DISPATCH", content: "An official dispatch has been issued for the delivery of sold 777-300ER aircraft. Pilots completing delivery missions will receive bonus credited flight hours, and delivered aircraft will be archived from active operations." },
            { date: "28 JAN 2026", title: "Additional 777-300ER Sale", tag: "FLEET", content: "Three additional Boeing 777-300ER aircraft have been sold, with delivery flights dispatched to Bangalore. These aircraft will be permanently retired from KLM Virtual Airlines upon delivery." },
            { date: "23 JAN 2026", title: "Widebody Qualification System Update", tag: "STAFF", content: "We are reworking the pilot ranking and qualification system. Widebody aircraft operations are temporarily restricted to senior staff, with certification available to pilots who meet minimum flight hour requirements." },
            { date: "20 JAN 2026", title: "Website v3.0 Launch", tag: "TECH", content: "Our redesigned KLM Virtual Airlines website v3.0 is now live, featuring real-time pilot tracking, updated fleet and route information, SOP documentation, and partner integrations. This platform reinforces our operations-first identity and professional pilot culture." },
            { date: "20 JAN 2026", title: "Long-Term Fleet Modernization Program", tag: "FLEET", content: "KLM Virtual Airlines is initiating a long-term fleet modernization program, phasing out the Boeing 777-300ER and Airbus A330-200 while introducing Airbus A320neo aircraft and planning Airbus A350-1000 deliveries beginning Q2 2026. Full fleet transition is targeted by 2027." },
            { date: "19 JAN 2026", title: "Sale of Boeing 777-300ER Aircraft", tag: "FLEET", content: "We have sold five Boeing 777-300ER aircraft as part of our ongoing fleet transition strategy. These aircraft will be removed from regular operations following delivery to their new operators." },
            { date: "16 JAN 2026", title: "Middle East Airspace Restrictions", tag: "ALERT", content: "Due to escalating regional tensions, KLM Virtual Airlines has implemented mandatory restrictions on Iraqi, Iranian, and Qatari airspace. Pilots must manually adjust flight plans to avoid restricted FIRs, with Saudi corridors permitted as an exception." },
            { date: "11 JAN 2026", title: "Airbus A320neo Fleet Deliveries", tag: "FLEET", content: "Nine Airbus A320neo aircraft have been delivered to Amsterdam and are entering service. These aircraft will support short- and medium-haul expansion and represent a key step in our fleet modernization strategy." },
            { date: "07 JAN 2026", title: "Planned Caribbean Service Resumption", tag: "OPS", content: "We plan to resume flights to St. Maarten by the end of March, with Aruba and Curaçao targeted for late April pending regional stability. These destinations are expected to see high seasonal demand during the summer period." },
            { date: "04 JAN 2026", title: "Schiphol Weather Disruptions", tag: "OPS", content: "Severe weather conditions at Amsterdam Schiphol have caused significant operational delays across the network. Current disruptions are affecting arrivals and departures, with extended delays impacting scheduled operations." },
            { date: "03 JAN 2026", title: "Suspension of Caribbean Operations", tag: "OPS", content: "Due to ongoing regional instability, all KLM Virtual Airlines flights to the Caribbean have been suspended until further notice. Safety and operational realism remain our highest priorities." },
            { date: "26 DEC 2025", title: "Launch of KLM Asia Subsidiary", tag: "FLEET", content: "We are launching KLM Asia, a subsidiary operating three Boeing 787-9 aircraft to maintain Taiwan operations without geopolitical restrictions. KLM Asia will operate under dedicated branding while remaining fully integrated into KLM Virtual Airlines operations." },
            { date: "26 DEC 2025", title: "Introduction of Premium Economy", tag: "FLEET", content: "KLM Virtual Airlines is introducing Premium Economy seating across the fleet to enhance passenger realism and comfort. Premium Economy will be available on both narrow-body and wide-body aircraft with seat distribution varying by aircraft type." },
            { date: "17 DEC 2025", title: "GASA Safety Certification", tag: "SAFETY", content: "We are proud to announce that KLM Virtual Airlines has been certified by the GeoFS Aviation Safety Authority (GASA). This certification establishes independent investigation procedures and formal safety oversight for all airline operations." },
            { date: "16 DEC 2025", title: "Integration into Lufthansa Group", tag: "PARTNERSHIP", content: "KLM Virtual Airlines has officially joined the Lufthansa Group Virtual, enabling mutual codeshare operations and alignment with Lufthansa operational standards. KLM will adopt Lufthansa SOPs and Miles & More program integration for cross-logging flights between both networks." },
            { date: "14 DEC 2025", title: "Cathay Pacific Codeshare Partnership", tag: "PARTNERSHIP", content: "KLM Virtual Airlines has launched a codeshare partnership with Cathay Pacific Virtual, expanding network connectivity across Europe, Asia, Africa, and Oceania. This agreement enables broader route availability and integrated operations between both airlines." },
            { date: "12 DEC 2025", title: "Interim COO Appointment", tag: "STAFF", content: "During the CEO’s temporary absence, JustFrost has been appointed Chief Operating Officer to ensure continuity of leadership, operational oversight, and strategic execution until the CEO’s return." },
            { date: "12 DEC 2025", title: "STARLUX Airlines Codeshare Partnership", tag: "PARTNERSHIP", content: "We have established a codeshare agreement with STARLUX Airlines Virtual on the Amsterdam–Taipei route. This partnership strengthens Asia–Europe connectivity and expands routing opportunities for pilots across both networks." },
            { date: "12 DEC 2025", title: "Qatar Airways Codeshare Partnership", tag: "PARTNERSHIP", content: "KLM Virtual Airlines and Qatar Airways Virtual have launched a codeshare partnership on the Amsterdam–Doha route. This partnership expands global connectivity, improves scheduling flexibility, and enhances realism in intercontinental network operations." },
            { date: "11 DEC 2025", title: "Fleet Data Update and ECO 2030 Initiative", tag: "FLEET", content: "We have updated fleet numbers to align with current real-world KLM data and have begun preparations for our ECO 2030 initiative, which will focus on realistic sustainability and operational modernization. Additional updates including aircraft registrations, financial system changes, and codeshare announcements will follow." },
            { date: "10 DEC 2025", title: "Airbus A330 Fleet Reduction", tag: "FLEET", content: "As part of our long-term fleet strategy, KLM Virtual Airlines has sold three Airbus A330-200 aircraft to the Emirates Group. This marks the beginning of our phased transition away from the A330 platform in favor of modernized fleet types." },
            { date: "09 DEC 2025", title: "Temporary Suspension of Flight Logging", tag: "OPS", content: "Due to technical issues with the GCRP logging system, we have temporarily suspended flight logging. Pilots are requested to refrain from submitting logs until the system is restored to ensure data integrity and accuracy." },
            { date: "06 DEC 2025", title: "Route Network Restructuring", tag: "NETWORK", content: "We have updated our route network to better reflect realistic KLM operations and operational feasibility. Several destinations have been removed to focus on core routes and improve dispatch realism, network coherence, and pilot experience." },
            { date: "04 DEC 2025", title: "Membership Milestone", tag: "COMMUNITY", content: "KLM Virtual Airlines has reached ten active human members. This milestone reflects early growth of our pilot community and continued interest in structured and realistic airline simulation operations." },
            { date: "04 DEC 2025", title: "Leadership Appointments", tag: "STAFF", content: "We are announcing the promotion of JustFrost to Chief Fleet Manager and K777-fly to Chairperson. These appointments formalize our early leadership structure and ensure that fleet planning, governance, and operational oversight are managed at a professional level as the airline grows." },
            { date: "25 NOV 2025", title: "First Operational Flight Completed", tag: "MILESTONE", content: "KLM Virtual Airlines has successfully completed its first recorded flight from Amsterdam Schiphol (EHAM) to Brussels (EBBR). This flight marks the beginning of official operations and establishes our initial procedures for flight logging, dispatch, and pilot activity tracking across the network." },
            { date: "28 OCT 2025", title: "Launch of KLM Virtual Airlines Operations", tag: "LAUNCH", content: "We are pleased to announce that the KLM Virtual Airlines server infrastructure has been completed and is now fully operational. With this launch, pilots and staff can begin structured operations, route logging, and community development under the KLM Virtual Airlines framework. This marks the formal start of our virtual airline and the foundation for future operational growth." }
        ];

        // --- TAG COLOR HELPER ---
        function getTagColor(tag) {
            const colors = {
                'URGENT': 'border-red-500 text-red-100 bg-red-900/50',
                'ALERT': 'border-red-500 text-red-100 bg-red-900/50',
                'OPS': 'border-amber-500 text-amber-100 bg-amber-900/50',
                'DISPATCH': 'border-amber-500 text-amber-100 bg-amber-900/50',
                'FLEET': 'border-blue-500 text-blue-100 bg-blue-900/50',
                'TECH': 'border-cyan-500 text-cyan-100 bg-cyan-900/50',
                'STAFF': 'border-purple-500 text-purple-100 bg-purple-900/50',
                'COMMUNITY': 'border-indigo-500 text-indigo-100 bg-indigo-900/50',
                'PARTNERSHIP': 'border-teal-500 text-teal-100 bg-teal-900/50',
                'EVENT': 'border-pink-500 text-pink-100 bg-pink-900/50',
                'MILESTONE': 'border-yellow-500 text-yellow-100 bg-yellow-900/50',
                'LAUNCH': 'border-emerald-500 text-emerald-100 bg-emerald-900/50',
                'SAFETY': 'border-green-500 text-green-100 bg-green-900/50',
                'NETWORK': 'border-sky-500 text-sky-100 bg-sky-900/50'
            };
            return colors[tag] || 'border-slate-500 text-slate-100 bg-slate-800';
        }

        const pages = {
            home: `
                <div class="relative bg-slate-900 text-white fade-in min-h-[90vh] flex flex-col">
                    <div class="relative py-24 px-4 sm:px-6 lg:px-8 flex-grow">
                         <div class="absolute inset-0 z-0">
                            <img src="${siteImages.homeHero}" class="w-full h-full object-cover" alt="KLM Ops">
                            <div class="absolute inset-0 bg-gradient-to-b from-slate-900 via-transparent to-slate-900"></div>
                        </div>
                        
                        <div class="relative z-10 max-w-7xl mx-auto">
                             <div class="inline-flex items-center gap-2 bg-black/50 border border-slate-700 text-slate-300 px-4 py-1.5 rounded-full mb-8 backdrop-blur-md">
                                <span class="w-2 h-2 rounded-full bg-red-600 animate-pulse"></span>
                                <span class="text-xs font-bold tracking-widest uppercase">Emergency Response</span>
                            </div>
                            <h1 class="text-5xl md:text-7xl font-black tracking-tight mb-6 leading-tight max-w-3xl">
                                Flying the World, <span class="text-klm">Virtually.</span>
                            </h1>
                            <p class="text-xl text-slate-300 mb-10 max-w-2xl font-light">Join a small, active, operations-focused community with realistic procedures and elite standards.</p>
                            
                            <!-- LIVE DISPATCH BOARD -->
                            <div class="mt-12">
                                <div class="flex justify-between items-center mb-4 max-w-5xl">
                                    <h3 class="text-xl font-bold flex items-center">
                                        <i data-lucide="monitor" class="w-5 h-5 mr-2 text-amber-500"></i> 
                                        Live Dispatch Board
                                    </h3>
                                    <!-- SYSTEM STATUS LIGHT -->
                                    <div class="flex items-center gap-2 bg-slate-800 px-3 py-1 rounded border border-slate-700">
                                        <div id="db-status-light" class="w-2 h-2 rounded-full bg-red-500 animate-pulse"></div>
                                        <span id="db-status-text" class="text-[10px] font-mono font-bold text-red-400 uppercase tracking-wider">OFFLINE</span>
                                    </div>
                                </div>
                                
                                <div class="fids-board max-w-5xl">
                                    <div class="fids-header">
                                        <div>Pilot</div>
                                        <div>Flight</div>
                                        <div>Date</div>
                                        <div class="hidden md:block">Route</div>
                                        <div>Aircraft</div>
                                        <div class="text-right">Status</div>
                                    </div>
                                    <div id="dispatch-rows">
                                        <div class="p-4 text-center text-slate-500 italic">Connecting to Dispatch Server...</div>
                                    </div>
                                </div>
                                <p class="text-xs text-slate-500 mt-2">Use the <strong>Dispatch</strong> page or Discord bot to book flights.</p>
                            </div>
                        </div>
                    </div>
                </div>
            `,
            
            condolences: `
                <div class="relative bg-black min-h-screen text-white fade-in py-24">
                    <div class="max-w-4xl mx-auto px-4 sm:px-6 lg:px-8">
                        <div class="text-center mb-16">
                            <img src="${siteImages.logo}" class="h-16 mx-auto mb-8 filter grayscale opacity-75">
                            <h1 class="text-4xl md:text-5xl font-serif font-bold text-slate-200 mb-4">In Memoriam</h1>
                            <p class="text-slate-500 uppercase tracking-widest text-sm">Flight KLM1016 • 23 JAN 2026</p>
                        </div>

                        <div class="bg-slate-900 border border-slate-800 p-8 md:p-12 rounded-lg shadow-2xl mb-12 relative overflow-hidden">
                             <div class="absolute top-0 left-0 w-full h-1 bg-gradient-to-r from-transparent via-slate-600 to-transparent opacity-50"></div>
                             
                             <h2 class="text-2xl font-bold text-slate-100 mb-6 text-center">OFFICIAL STATEMENT</h2>
                             
                             <div class="prose prose-invert prose-lg mx-auto text-slate-300 leading-relaxed font-light">
                                <p><strong>KLM confirms that Flight KLM1016</strong>, operated by an Embraer 190 from Amsterdam Schiphol (EHAM) to London Heathrow (EGLL), was involved in a fatal accident in the North Sea shortly after departure on 23 January at 17:25 UTC.</p>
                                
                                <p>All 94 passengers and crew on board have been confirmed deceased. This is a tragic loss of life, and our deepest condolences go to the families, friends, and colleagues of those affected.</p>
                                
                                <p>KLM is fully cooperating with the Global Aviation Safety Authority (GASA) in an independent investigation. Flight data, maintenance records, and crew training documentation are being preserved and provided to investigators.</p>
                                
                                <hr class="border-slate-800 my-8">
                                
                                <h3 class="text-lg font-bold text-white mb-2">Compensation and Family Support</h3>
                                <p>KLM will provide an immediate ex gratia payment of USD 100,000 per victim to next of kin as an initial humanitarian measure. Additional compensation will be determined following the conclusion of the investigation.</p>
                                
                                <h3 class="text-lg font-bold text-white mb-2 mt-6">Operational Response</h3>
                                <ul class="list-disc pl-5 space-y-2">
                                    <li>All Embraer 190 operations are undergoing immediate internal safety review.</li>
                                    <li>Pilot onboarding and training procedures are being audited and revised.</li>
                                    <li>Additional safety directives will be issued across the fleet as findings develop.</li>
                                </ul>

                                <div class="bg-black/30 p-4 rounded mt-8 text-sm text-slate-400 italic border-l-2 border-slate-600">
                                    This statement refers to the independent virtual airline operation using the KLM branding and is not affiliated with KLM Royal Dutch Airlines or the Air France–KLM Group.
                                </div>
                             </div>

                             <div class="mt-12 text-center">
                                <p class="font-serif italic text-slate-400">Signed,</p>
                                <p class="font-bold text-white mt-2">Nihid</p>
                                <p class="text-xs text-slate-500 uppercase tracking-wide">Co-Chairman, KLM VA</p>
                             </div>

                             <!-- CONDOLENCES BUTTON & COUNTER -->
                             <div class="mt-16 pt-8 border-t border-slate-800 text-center">
                                <button id="condolence-btn" onclick="window.submitCondolence()" class="group relative inline-flex items-center justify-center px-8 py-3 text-base font-medium text-white bg-slate-800 border border-slate-700 rounded-full hover:bg-slate-700 transition-all duration-300 shadow-lg hover:shadow-indigo-500/20 active:scale-95 disabled:opacity-50 disabled:cursor-not-allowed">
                                    <span class="absolute w-full h-full bg-gradient-to-r from-indigo-500/20 to-purple-500/20 opacity-0 group-hover:opacity-100 transition-opacity duration-300 rounded-full pointer-events-none"></span>
                                    <i data-lucide="heart" class="w-5 h-5 mr-3 text-red-500 fill-current animate-pulse"></i>
                                    <span id="condolence-btn-text">Pay Respects</span>
                                </button>
                                <div class="mt-4 flex items-center justify-center gap-2 text-sm text-slate-500 font-mono uppercase tracking-widest">
                                    <span id="condolence-count" class="text-white font-bold text-lg tabular-nums">---</span>
                                    <span>Tributes Paid</span>
                                </div>
                             </div>
                        </div>

                        <div class="text-center">
                            <button onclick="router('home')" class="text-slate-500 hover:text-white transition text-sm uppercase tracking-widest">Return to Operations</button>
                        </div>
                    </div>
                </div>
            `,

            news: `
                <div class="relative bg-slate-900 py-24 fade-in">
                    <div class="max-w-4xl mx-auto px-4 sm:px-6 lg:px-8">
                        <div class="border-b border-slate-700 pb-8 mb-12">
                            <h1 class="text-4xl font-black text-white mb-4">Official Archives</h1>
                            <p class="text-slate-400 text-lg">Complete record of all KLM VA operational directives and community announcements.</p>
                        </div>
                        
                        <div class="space-y-8">
                            ${newsData.map(news => {
                                const colorClass = getTagColor(news.tag);
                                return `
                                <article class="bg-slate-800 rounded-lg p-6 border-l-4 news-card shadow-lg ${colorClass.split(' ')[0]}">
                                    <div class="flex items-center gap-3 mb-3 text-xs font-mono text-slate-400 uppercase tracking-widest">
                                        <span class="font-bold px-2 py-0.5 rounded ${colorClass}">${news.tag}</span>
                                        <span>${news.date}</span>
                                    </div>
                                    <h2 class="text-xl font-bold text-white mb-3">${news.title}</h2>
                                    <div class="text-slate-300 leading-relaxed text-sm">
                                        ${news.content}
                                    </div>
                                </article>
                            `}).join('')}
                        </div>
                    </div>
                </div>
            `,

            fleet: `
                <div class="relative bg-slate-900 py-24 fade-in">
                    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
                        <div class="text-center mb-16">
                            <h1 class="text-4xl font-black text-white mb-4">Fleet Manifest</h1>
                            <p class="text-slate-400 max-w-2xl mx-auto">Strategic asset allocation. Our fleet is modernized for efficiency and operational realism.</p>
                        </div>
                        
                        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8">
                            ${fleetData.map(plane => {
                                let statusColor = plane.status === 'Active' ? 'text-emerald-400 border-emerald-500/30 bg-emerald-500/10' : 
                                                  plane.status === 'Phasing Out' ? 'text-amber-400 border-amber-500/30 bg-amber-500/10' : 
                                                  plane.status === 'LTRP' ? 'text-purple-400 border-purple-500/30 bg-purple-500/10' :
                                                  'text-indigo-400 border-indigo-500/30 bg-indigo-500/10';
                                return `
                                <div class="bg-slate-800 rounded-lg overflow-hidden border border-slate-700 hover:border-klm transition duration-300 group shadow-lg hover:shadow-2xl relative">
                                    <div class="absolute inset-0 bg-gradient-to-t from-slate-900 via-transparent to-transparent opacity-50 z-10 pointer-events-none"></div>
                                    <div class="h-56 overflow-hidden relative">
                                        <img src="${plane.img}" class="w-full h-full object-cover opacity-80 group-hover:opacity-100 group-hover:scale-105 transition duration-700" onerror="this.src='https://upload.wikimedia.org/wikipedia/commons/thumb/a/ac/No_image_available.svg/1024px-No_image_available.svg.png'">
                                        <div class="absolute top-3 right-3 ${statusColor} border px-2 py-1 rounded text-xs font-bold uppercase tracking-wider backdrop-blur-md z-20 shadow-sm">
                                            ${plane.status}
                                        </div>
                                    </div>
                                    <div class="p-6 relative z-20 bg-slate-800">
                                        <div class="flex justify-between items-baseline mb-2">
                                            <h3 class="text-xl font-bold text-white tracking-tight">${plane.type}</h3>
                                            <span class="text-slate-500 text-sm font-mono">QTY: ${plane.count}</span>
                                        </div>
                                        <div class="text-klm text-xs font-bold uppercase tracking-wide mb-3 flex items-center gap-2">
                                            <div class="w-1.5 h-1.5 rounded-full bg-klm"></div>
                                            ${plane.role}
                                        </div>
                                        <div class="text-[10px] text-slate-500 font-mono mb-3 bg-slate-900/50 inline-block px-2 py-1 rounded">ICAO: ${plane.icao}</div>
                                        <p class="text-slate-400 text-sm leading-relaxed border-t border-slate-700 pt-3">${plane.desc}</p>
                                    </div>
                                </div>
                                `
                            }).join('')}
                        </div>
                    </div>
                </div>
            `,

            booking: `
                <div class="relative bg-slate-50 py-12 fade-in">
                    <div class="max-w-4xl mx-auto px-4 sm:px-6 lg:px-8">
                        <div class="mb-8">
                            <h1 class="text-3xl font-black text-slate-900">Flight Dispatch</h1>
                            <p class="text-slate-500">Create a flight plan and book your slot on the operations board.</p>
                        </div>

                        <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
                            <!-- Booking Form -->
                            <div class="lg:col-span-2 bg-white p-6 rounded-xl shadow-sm border border-slate-200">
                                <form id="booking-form" onsubmit="window.handleBookingSubmit(event)">
                                    
                                    <div class="mb-6 border-b border-slate-100 pb-6">
                                        <h3 class="text-sm font-bold text-slate-400 uppercase tracking-wider mb-4">Pilot Identification</h3>
                                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4" id="login-section">
                                            <!-- Dynamically filled by JS -->
                                        </div>
                                    </div>

                                    <div class="mb-6 border-b border-slate-100 pb-6">
                                        <div class="flex items-center justify-between mb-4">
                                            <h3 class="text-sm font-bold text-slate-400 uppercase tracking-wider">Flight Parameters</h3>
                                            <label class="flex items-center gap-2 cursor-pointer">
                                                <span class="text-xs font-bold text-slate-500 uppercase">Custom Route / Charter</span>
                                                <input type="checkbox" id="custom-route-toggle" onchange="window.toggleCustomRoute()" class="accent-klm">
                                            </label>
                                        </div>

                                        <!-- Standard Controls -->
                                        <div id="standard-controls">
                                            <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
                                                <div>
                                                    <label class="block text-sm font-medium text-slate-700 mb-1">Direction</label>
                                                    <div class="flex gap-2">
                                                        <button type="button" onclick="window.setDirection('out')" id="btn-out" class="flex-1 py-2 border rounded font-bold text-sm bg-klm text-white border-klm">Outbound</button>
                                                        <button type="button" onclick="window.setDirection('in')" id="btn-in" class="flex-1 py-2 border rounded font-bold text-sm bg-white text-slate-600 border-slate-300">Inbound</button>
                                                    </div>
                                                </div>
                                                <div>
                                                    <label class="block text-sm font-medium text-slate-700 mb-1">Region</label>
                                                    <select id="region-select" onchange="window.updateDestinations()" class="w-full bg-slate-50 border border-slate-300 rounded p-2 outline-none"></select>
                                                </div>
                                            </div>

                                            <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
                                                <div>
                                                    <label class="block text-sm font-medium text-slate-700 mb-1">Destination / Origin</label>
                                                    <select id="dest-select" onchange="window.updateFlightDetails()" class="w-full bg-slate-50 border border-slate-300 rounded p-2 outline-none"></select>
                                                </div>
                                                <div>
                                                    <label class="block text-sm font-medium text-slate-700 mb-1">Flight Number</label>
                                                    <select id="flight-select" onchange="window.updatePreview()" class="w-full bg-slate-50 border border-slate-300 rounded p-2 outline-none"></select>
                                                </div>
                                            </div>
                                        </div>

                                        <!-- Custom Controls (Hidden) -->
                                        <div id="custom-controls" class="hidden">
                                            <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-4">
                                                <div>
                                                    <label class="block text-sm font-medium text-slate-700 mb-1">Departure ICAO</label>
                                                    <input type="text" id="custom-dep" placeholder="EHAM" maxlength="4" oninput="this.value = this.value.toUpperCase(); window.updatePreview()" class="w-full bg-slate-50 border border-slate-300 rounded p-2 outline-none font-mono uppercase">
                                                </div>
                                                <div>
                                                    <label class="block text-sm font-medium text-slate-700 mb-1">Arrival ICAO</label>
                                                    <input type="text" id="custom-arr" placeholder="KJFK" maxlength="4" oninput="this.value = this.value.toUpperCase(); window.updatePreview()" class="w-full bg-slate-50 border border-slate-300 rounded p-2 outline-none font-mono uppercase">
                                                </div>
                                                <div>
                                                    <label class="block text-sm font-medium text-slate-700 mb-1">Flight Number</label>
                                                    <input type="text" id="custom-flight" placeholder="KL..." maxlength="7" oninput="this.value = this.value.toUpperCase(); window.updatePreview()" class="w-full bg-slate-50 border border-slate-300 rounded p-2 outline-none font-mono uppercase">
                                                </div>
                                            </div>
                                        </div>

                                        <div class="bg-slate-100 rounded p-3 flex justify-between items-center text-sm font-mono text-slate-600 border border-slate-200">
                                            <div class="text-center">
                                                <div class="text-[10px] uppercase text-slate-400">Departure</div>
                                                <div id="disp-dep" class="font-bold text-lg text-slate-900">----</div>
                                            </div>
                                            <div class="text-slate-400">
                                                <i data-lucide="plane" class="w-5 h-5 rotate-90"></i>
                                            </div>
                                            <div class="text-center">
                                                <div class="text-[10px] uppercase text-slate-400">Arrival</div>
                                                <div id="disp-arr" class="font-bold text-lg text-slate-900">----</div>
                                            </div>
                                        </div>
                                    </div>

                                    <div class="mb-6 border-b border-slate-100 pb-6">
                                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                            <div>
                                                <label class="block text-sm font-medium text-slate-700 mb-1">Aircraft</label>
                                                <select id="aircraft-select" onchange="window.updatePreview()" class="w-full bg-slate-50 border border-slate-300 rounded p-2 outline-none"></select>
                                            </div>
                                            <div>
                                                <label class="block text-sm font-medium text-slate-700 mb-1">Departure Time (Zulu)</label>
                                                <input type="time" id="dep-time" onchange="window.updatePreview()" required class="w-full bg-slate-50 border border-slate-300 rounded p-2 outline-none">
                                            </div>
                                        </div>
                                    </div>

                                    <!-- NEW: TEST FLIGHT CHECKBOX -->
                                    <div class="mb-8">
                                        <label class="flex items-center gap-3 cursor-pointer group">
                                            <div class="relative">
                                                <input type="checkbox" id="is-test-flight" class="sr-only peer">
                                                <div class="w-10 h-6 bg-slate-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-klm/20 rounded-full peer peer-checked:after:translate-x-full rtl:peer-checked:after:-translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:start-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-klm"></div>
                                            </div>
                                            <span class="text-sm font-bold text-slate-600 group-hover:text-klm transition">Mark as Test Flight</span>
                                            <div class="bg-amber-100 text-amber-700 text-[10px] font-bold px-2 py-0.5 rounded border border-amber-200 uppercase tracking-wider">Board status: TEST</div>
                                        </label>
                                    </div>

                                    <button type="submit" class="w-full bg-klm hover:bg-klm-dark text-white font-bold py-3 rounded shadow-lg transition transform active:scale-95 flex justify-center items-center disabled:opacity-50 disabled:cursor-not-allowed">
                                        <i data-lucide="check-circle" class="w-5 h-5 mr-2"></i> Confirm Booking
                                    </button>

                                </form>
                            </div>

                            <!-- Flight Strip -->
                            <div class="lg:col-span-1">
                                <h3 class="text-sm font-bold text-slate-400 uppercase tracking-wider mb-4">Flight Strip Preview</h3>
                                <div class="bg-slate-800 text-white p-4 rounded-lg shadow-xl border-l-4 border-amber-500 font-mono text-sm relative overflow-hidden">
                                    <div class="flex justify-between items-start mb-4 relative z-10">
                                        <div>
                                            <div class="text-xs text-slate-400">CALLSIGN</div>
                                            <div class="text-xl font-bold text-amber-400" id="preview-callsign">KLM---</div>
                                        </div>
                                        <div class="text-right">
                                            <div class="text-xs text-slate-400">AIRCRAFT</div>
                                            <div class="font-bold" id="preview-ac">---</div>
                                        </div>
                                    </div>
                                    
                                    <div class="grid grid-cols-2 gap-4 mb-4 relative z-10">
                                        <div class="bg-slate-900/50 p-2 rounded">
                                            <div class="text-[10px] text-slate-400">DEP</div>
                                            <div class="font-bold text-lg" id="preview-dep">----</div>
                                        </div>
                                        <div class="bg-slate-900/50 p-2 rounded text-right">
                                            <div class="text-[10px] text-slate-400">ARR</div>
                                            <div class="font-bold text-lg" id="preview-arr">----</div>
                                        </div>
                                    </div>

                                    <div class="border-t border-slate-700 pt-3 relative z-10">
                                        <div class="flex justify-between items-center">
                                            <div>
                                                <div class="text-[10px] text-slate-400">PIC</div>
                                                <div class="font-bold truncate max-w-[120px]" id="preview-pilot">---</div>
                                            </div>
                                            <div class="text-right">
                                                <div class="text-[10px] text-slate-400">EOBT</div>
                                                <div class="font-bold text-emerald-400" id="preview-time">--:--</div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            `,

            routes: `
                <div class="relative bg-white py-24 fade-in">
                    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
                        <div class="flex flex-col md:flex-row gap-12 mb-12">
                            <div class="md:w-1/3">
                                <h1 class="text-4xl font-black text-slate-900 mb-6">Network Deployment</h1>
                                <p class="text-slate-600 leading-relaxed mb-6">
                                    Our route network is built around <strong>Amsterdam (EHAM)</strong> as a hub, with routes deployed strategically based on fleet capability.
                                </p>
                            </div>
                            <div class="md:w-2/3 relative h-[400px] bg-slate-900 rounded-xl overflow-hidden border border-slate-800 shadow-2xl">
                                <div id="fleet-map"></div>
                            </div>
                        </div>

                        <div class="flex flex-wrap gap-2 mb-8 border-b border-slate-200 pb-4">
                            ${Object.keys(routeData).map(region => `
                                <button onclick="window.renderRouteGrid('${region}')" 
                                    class="route-btn px-4 py-2 rounded text-sm font-bold uppercase tracking-wide transition focus:outline-none"
                                    id="btn-${region}">
                                    ${region}
                                </button>
                            `).join('')}
                        </div>
                        <div id="route-grid" class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4"></div>
                    </div>
                </div>
            `,

            livemap: `
                <div class="flex flex-col h-[calc(100vh-80px)] fade-in">
                    <div class="bg-slate-900 px-6 py-4 flex justify-between items-center border-b border-slate-800">
                        <div>
                            <h1 class="text-xl font-bold text-white flex items-center gap-2">
                                <span class="w-2 h-2 rounded-full bg-red-500 animate-pulse"></span> 
                                LIVE OPERATIONS
                            </h1>
                        </div>
                    </div>
                    <div class="flex-grow bg-slate-800 relative">
                        <iframe src="https://radarthing.com/radar?callsign=KLM,KL" class="absolute inset-0 w-full h-full border-0" allowfullscreen></iframe>
                    </div>
                </div>
            `,

            sop: `
                <div class="bg-slate-50 py-24 fade-in">
                    <div class="max-w-4xl mx-auto px-4 sm:px-6 lg:px-8">
                        <div class="text-center mb-16">
                            <h1 class="text-4xl font-black text-slate-900 mb-4">Standard Operating Procedures</h1>
                            <p class="text-slate-600 max-w-2xl mx-auto">Discipline is what separates us from the rest.</p>
                        </div>
                        <div class="space-y-8">
                            <div class="bg-white p-8 rounded-xl shadow-sm border-l-4 border-klm">
                                <h3 class="text-xl font-bold text-slate-900 mb-4">Phase 1: Preparation</h3>
                                <p class="text-slate-600">SimBrief Flight Plan Mandatory. Doors closed 5-15 min prior to departure.</p>
                            </div>
                            <div class="bg-white p-8 rounded-xl shadow-sm border-l-4 border-klm">
                                <h3 class="text-xl font-bold text-slate-900 mb-4">Phase 2: Execution</h3>
                                <div class="grid grid-cols-2 md:grid-cols-4 gap-4 text-center">
                                    <div class="p-3 bg-slate-50 border"><strong>Taxi</strong><br>Max 25 kts</div>
                                    <div class="p-3 bg-slate-50 border"><strong>&lt;10k ft</strong><br>250 kts</div>
                                    <div class="p-3 bg-slate-50 border"><strong>Cruise</strong><br>Cost Index</div>
                                    <div class="p-3 bg-slate-50 border"><strong>Sep</strong><br>1000ft</div>
                                </div>
                            </div>
                            <div class="bg-white p-8 rounded-xl shadow-sm border-l-4 border-klm">
                                <h3 class="text-xl font-bold text-slate-900 mb-4">Phase 3: Validation</h3>
                                <p class="text-slate-600">Submit logs to Discord channel with Dep/Arr, Time, Name, and Screenshot.</p>
                            </div>
                        </div>
                    </div>
                </div>
            `,

            partners: `
                <div class="bg-white py-24 fade-in">
                    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
                        <div class="bg-slate-900 rounded-2xl p-8 md:p-12 mb-16 text-white relative overflow-hidden">
                             <div class="relative z-10 flex flex-col md:flex-row gap-12 items-center">
                                <div class="md:w-1/2">
                                    <div class="text-amber-400 text-xs font-bold uppercase tracking-widest mb-2">Parent Airline Group</div>
                                    <h2 class="text-4xl font-bold mb-4">Lufthansa Group (DLH)</h2>
                                    <p class="text-slate-300 text-lg leading-relaxed mb-6">
                                        DLH holds a minority stake, providing operational stability while KLM VA runs independently, focused on active pilots and realistic operations.
                                    </p>
                                    <div class="flex gap-4">
                                        <a href="https://midmm2tehdumb.github.io/Lufthansa-Group/index.html" target="_blank" class="border border-white/20 hover:bg-white/10 px-6 py-2 rounded font-bold transition">Visit DLH</a>
                                        <a href="https://discord.gg/TJRUPZj3t9" target="_blank" class="bg-amber-500 hover:bg-amber-600 text-slate-900 px-6 py-2 rounded font-bold transition">Discord</a>
                                    </div>
                                </div>
                                <div class="md:w-1/2 grid grid-cols-2 gap-4">
                                    <div class="bg-white/5 p-4 rounded border border-white/10">
                                        <div class="text-2xl font-bold text-amber-400">Platinum</div>
                                        <div class="text-xs text-slate-400 uppercase">GASA Rating</div>
                                    </div>
                                    <div class="bg-white/5 p-4 rounded border border-white/10">
                                        <div class="text-2xl font-bold text-amber-400">A+</div>
                                        <div class="text-xs text-slate-400 uppercase">ICAO Rating</div>
                                    </div>
                                </div>
                             </div>
                        </div>

                        <div class="grid grid-cols-1 md:grid-cols-2 gap-12">
                             <div class="bg-slate-50 p-6 rounded-lg border border-slate-200">
                                <h4 class="font-bold text-klm mb-2">GASA (Safety Authority)</h4>
                                <p class="text-sm text-slate-600 mb-3">Ensures safety, fairness, and realism. Operating as a neutral global oversight body.</p>
                            </div>
                            <div class="bg-slate-50 p-6 rounded-lg border border-slate-200">
                                <h4 class="font-bold text-sky-600 mb-2">ICAO Community</h4>
                                <p class="text-sm text-slate-600 mb-3">Prevents chaos and fragmentation. Provides the shared framework for recognition.</p>
                                <div class="inline-block bg-green-100 text-green-800 text-xs font-bold px-2 py-1 rounded">Certified Organisation</div>
                            </div>
                        </div>
                    </div>
                </div>
            `,

            community: `
                <div class="bg-slate-900 py-24 fade-in">
                    <div class="max-w-6xl mx-auto px-4 sm:px-6 lg:px-8">
                        <div class="text-center mb-16">
                            <h1 class="text-4xl font-black text-white mb-6">The Elite Core</h1>
                            <p class="text-slate-400 text-xl max-w-3xl mx-auto leading-relaxed">
                                KLM VA is small, elite, and operations-first. Every member matters — we value skill, realism, and commitment over numbers.
                            </p>
                        </div>

                        <div class="grid grid-cols-1 md:grid-cols-4 gap-8 mb-24">
                            <!-- Trainee -->
                            <div class="bg-slate-800 p-6 rounded-lg border border-slate-700 text-center group hover:border-klm transition duration-300">
                                <div class="epaulette mb-4 mx-auto group-hover:scale-110 transition duration-300">
                                    <div class="stripe"></div>
                                </div>
                                <h3 class="text-white font-bold text-lg">Trainee</h3>
                                <div class="text-slate-400 text-sm font-mono mt-2 mb-4">0 - 5 Hours</div>
                                <div class="inline-block bg-slate-900/50 text-indigo-300 text-[10px] uppercase font-bold px-3 py-1 rounded border border-indigo-500/20">
                                    Entry Exams
                                </div>
                            </div>

                            <!-- Junior Officer -->
                            <div class="bg-slate-800 p-6 rounded-lg border border-slate-700 text-center group hover:border-klm transition duration-300">
                                <div class="epaulette mb-4 mx-auto group-hover:scale-110 transition duration-300">
                                    <div class="stripe"></div><div class="stripe"></div>
                                </div>
                                <h3 class="text-white font-bold text-lg">Junior Officer</h3>
                                <div class="text-slate-400 text-sm font-mono mt-2 mb-4">5 - 15 Hours</div>
                                <div class="inline-block bg-slate-900/50 text-emerald-300 text-[10px] uppercase font-bold px-3 py-1 rounded border border-emerald-500/20">
                                    Short Haul Ops
                                </div>
                            </div>

                            <!-- First Officer -->
                            <div class="bg-slate-800 p-6 rounded-lg border border-slate-700 text-center group hover:border-klm transition duration-300">
                                <div class="epaulette mb-4 mx-auto group-hover:scale-110 transition duration-300">
                                    <div class="stripe"></div><div class="stripe"></div><div class="stripe"></div>
                                </div>
                                <h3 class="text-white font-bold text-lg">First Officer</h3>
                                <div class="text-slate-400 text-sm font-mono mt-2 mb-4">15 - 50 Hours</div>
                                <div class="inline-block bg-slate-900/50 text-sky-300 text-[10px] uppercase font-bold px-3 py-1 rounded border border-sky-500/20">
                                    Medium Haul Ops
                                </div>
                            </div>

                            <!-- Captain -->
                            <div class="bg-slate-800 p-6 rounded-lg border border-slate-700 text-center group hover:border-klm transition duration-300">
                                <div class="epaulette mb-4 mx-auto group-hover:scale-110 transition duration-300">
                                    <div class="stripe"></div><div class="stripe"></div><div class="stripe"></div><div class="stripe"></div>
                                </div>
                                <h3 class="text-white font-bold text-lg">Captain</h3>
                                <div class="text-slate-400 text-sm font-mono mt-2 mb-4">50+ Hours</div>
                                <div class="inline-block bg-slate-900/50 text-amber-300 text-[10px] uppercase font-bold px-3 py-1 rounded border border-amber-500/20">
                                    Long Haul Command
                                </div>
                            </div>
                        </div>

                        <div class="bg-white rounded-xl p-8 md:p-12">
                            <h3 class="text-2xl font-bold text-slate-900 mb-8">Code of Conduct</h3>
                            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8">
                                <div>
                                    <h4 class="font-bold text-klm mb-2">01. Professionalism</h4>
                                    <p class="text-sm text-slate-600">Communication must be courteous. Disrespect is not tolerated in our airspace.</p>
                                </div>
                                <div>
                                    <h4 class="font-bold text-klm mb-2">02. Integrity</h4>
                                    <p class="text-sm text-slate-600">Operational honesty is paramount. Logs must be accurate and verifiable.</p>
                                </div>
                                <div>
                                    <h4 class="font-bold text-klm mb-2">03. Chain of Command</h4>
                                    <p class="text-sm text-slate-600">Respect staff decisions. They ensure the integrity of the VA.</p>
                                </div>
                                <div>
                                    <h4 class="font-bold text-klm mb-2">04. Privacy</h4>
                                    <p class="text-sm text-slate-600">Protect member data. Doxxing or sharing private info results in immediate expulsion.</p>
                                </div>
                                <div>
                                    <h4 class="font-bold text-klm mb-2">05. Safety</h4>
                                    <p class="text-sm text-slate-600">Strictly SFW environment. We maintain a professional simulation atmosphere.</p>
                                </div>
                                <div>
                                    <h4 class="font-bold text-klm mb-2">06. Excellence</h4>
                                    <p class="text-sm text-slate-600">We fly to a higher standard. Continual improvement is expected.</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            `
        };

        // --- CONDOLENCE LOGIC ---
        let condolenceUnsubscribe = null;

        window.submitCondolence = async () => {
            const btn = document.getElementById('condolence-btn');
            const btnText = document.getElementById('condolence-btn-text');
            
            // Check local state to prevent spam
            if (localStorage.getItem('klm_condolence_submitted')) {
                alert("Thank you. You have already paid your respects.");
                return;
            }

            if (!db) return;

            // Optimistic UI update
            btn.disabled = true;
            btnText.textContent = "Submitting...";

            try {
                const ref = doc(db, "site_stats", "condolences");
                
                // Try to update, if doc doesn't exist, create it
                try {
                    await updateDoc(ref, { count: increment(1) });
                } catch (e) {
                    // Document likely doesn't exist, create it
                    await setDoc(ref, { count: 1 });
                }

                // Mark as submitted locally
                localStorage.setItem('klm_condolence_submitted', 'true');
                btnText.textContent = "Respects Paid";
                
            } catch (e) {
                console.error("Error submitting condolence:", e);
                btn.disabled = false;
                btnText.textContent = "Try Again";
            }
        };

        function initCondolences() {
            if (!db) return;
            const ref = doc(db, "site_stats", "condolences");
            
            // Check if user already submitted
            if (localStorage.getItem('klm_condolence_submitted')) {
                const btn = document.getElementById('condolence-btn');
                const btnText = document.getElementById('condolence-btn-text');
                if(btn && btnText) {
                    btn.disabled = true;
                    btnText.textContent = "Respects Paid";
                }
            }

            condolenceUnsubscribe = onSnapshot(ref, (docSnap) => {
                const countEl = document.getElementById('condolence-count');
                if (countEl) {
                    if (docSnap.exists()) {
                        countEl.textContent = docSnap.data().count.toLocaleString();
                    } else {
                        countEl.textContent = "0";
                    }
                }
            });
        }


        // --- FIXED ROUTER LOGIC ---
        let dispatchUnsubscribe = null; 

        function router(pageName) {
            // Cleanup Dispatch Listener
            if (dispatchUnsubscribe) {
                dispatchUnsubscribe();
                dispatchUnsubscribe = null;
            }
            // Cleanup Condolence Listener
            if (condolenceUnsubscribe) {
                condolenceUnsubscribe();
                condolenceUnsubscribe = null;
            }

            const contentDiv = document.getElementById('app-content');
            contentDiv.innerHTML = pages[pageName] || pages['home'];
            
            // Page Init Logic
            if (pageName === 'routes') { setTimeout(() => { initFleetMap(); renderRouteGrid('Europe'); }, 100); }
            if (pageName === 'booking') { setTimeout(initBookingPage, 100); }
            if (pageName === 'home') { setTimeout(initDispatchBoard, 500); }
            if (pageName === 'condolences') { setTimeout(initCondolences, 100); }

            lucide.createIcons();
            window.scrollTo(0, 0);
            document.querySelectorAll('.nav-link').forEach(btn => {
                if(btn.getAttribute('onclick').includes(pageName)) {
                    btn.classList.add('active', 'text-klm');
                    btn.classList.remove('text-slate-600');
                } else {
                    btn.classList.remove('active', 'text-klm');
                    btn.classList.add('text-slate-600');
                }
            });
        }
        window.router = router;

        // --- BOOKING LOGIC ---
        let currentDirection = 'out';
        let bookingRouteList = [];

        function initBookingPage() {
            const regionSelect = document.getElementById('region-select');
            const acSelect = document.getElementById('aircraft-select');
            const loginSection = document.getElementById('login-section');
            const bookingFormBtn = document.querySelector('#booking-form button[type="submit"]');

            const regions = Object.keys(routeData);
            if(regionSelect) regionSelect.innerHTML = regions.map(r => `<option value="${r}">${r}</option>`).join('');
            if(acSelect) acSelect.innerHTML = fleetData.filter(f => f.status === 'Active' || f.status === 'Phasing Out' || f.status === 'LTRP').map(f => `<option value="${f.type}">${f.type}</option>`).join('');
            
            // Handle Login UI & Membership Check
            if(loginSection) {
                if(discordUser) {
                    if (discordUser.isMember) {
                        // User IS authenticated AND a member of the server
                        loginSection.innerHTML = `
                            <div class="col-span-2 flex items-center gap-4 bg-slate-50 p-4 rounded border border-emerald-200">
                                 <img src="https://cdn.discordapp.com/avatars/${discordUser.id}/${discordUser.avatar}.png" 
                                      class="w-12 h-12 rounded-full border-2 border-white shadow" 
                                      onerror="this.src='https://cdn.discordapp.com/embed/avatars/0.png'">
                                 <div class="flex-grow">
                                    <div class="text-sm text-slate-500 font-bold uppercase tracking-wider">Authenticated Pilot</div>
                                    <div class="text-lg font-black text-slate-800">${discordUser.username}</div>
                                 </div>
                                 <div class="flex flex-col items-end gap-2">
                                     <div class="bg-emerald-100 text-emerald-700 px-3 py-1 rounded text-xs font-bold uppercase tracking-wide">
                                        <i data-lucide="check-circle" class="w-3 h-3 inline mr-1"></i> Verified
                                     </div>
                                     <button onclick="window.doLogout()" class="text-[10px] text-red-400 hover:text-red-600 underline font-bold uppercase tracking-wider">Log Out</button>
                                 </div>
                            </div>
                        `;
                        if(bookingFormBtn) {
                            bookingFormBtn.disabled = false;
                            bookingFormBtn.classList.remove('opacity-50', 'cursor-not-allowed');
                        }
                    } else {
                        // User IS authenticated but NOT a member (or cache is stale)
                        const discordAuthUrl = "https://discord.com/oauth2/authorize?client_id=1464272995542634566&response_type=token&redirect_uri=https%3A%2F%2Fklmgeofsvirtual.github.io%2Fklm-virtual-airline%2F&scope=identify+guilds";
                        
                         loginSection.innerHTML = `
                            <div class="col-span-2 bg-red-50 p-4 rounded border border-red-200 flex items-center gap-4">
                                <div class="text-red-500"><i data-lucide="alert-circle" class="w-8 h-8"></i></div>
                                <div>
                                    <h4 class="text-red-800 font-bold text-sm uppercase">Access Denied</h4>
                                    <p class="text-red-600 text-xs mt-1">
                                        You are logged in as <strong>${discordUser.username}</strong>, but the system cannot verify your membership in the KLM VA Discord.
                                    </p>
                                    <div class="flex gap-3 mt-2">
                                        <a href="https://discord.gg/vRzmhuEmBQ" target="_blank" class="text-xs font-bold text-red-700 underline hover:text-red-900">1. Join Server</a>
                                        <button onclick="localStorage.removeItem('klm_discord_user'); window.location.href = '${discordAuthUrl}';" class="text-xs font-bold text-blue-600 underline hover:text-blue-800">2. Already a Member? Sync Permissions</button>
                                    </div>
                                </div>
                            </div>
                        `;
                        if(bookingFormBtn) {
                            bookingFormBtn.disabled = true;
                            bookingFormBtn.classList.add('opacity-50', 'cursor-not-allowed');
                        }
                    }
                    lucide.createIcons();
                } else {
                    const discordAuthUrl = "https://discord.com/oauth2/authorize?client_id=1464272995542634566&response_type=token&redirect_uri=https%3A%2F%2Fklmgeofsvirtual.github.io%2Fklm-virtual-airline%2F&scope=identify+guilds";
                    
                    loginSection.innerHTML = `
                        <div class="col-span-2">
                             <a href="${discordAuthUrl}" class="flex items-center justify-center w-full bg-[#5865F2] hover:bg-[#4752C4] text-white font-bold py-3 rounded transition shadow-lg transform active:scale-95">
                                <svg class="w-6 h-6 mr-3" fill="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                    <path d="M20.317 4.37a19.791 19.791 0 0 0-4.885-1.515.074.074 0 0 0-.079.037 20.818 20.818 0 0 0-3.361 6.91 20.8 20.8 0 0 0-3.356-6.91.071.071 0 0 0-.077-.037 19.782 19.782 0 0 0-4.886 1.515.072.072 0 0 0-.032.027C.533 9.046-.32 13.58.099 18.057a.082.082 0 0 0 .031.057 19.9 19.9 0 0 0 5.993 3.03.078.078 0 0 0 .084-.028 14.09 14.09 0 0 0 1.226-1.994.076.076 0 0 0-.041-.106 13.107 13.107 0 0 1-1.872-.892.077.077 0 0 1-.008-.128 10.2 10.2 0 0 0 .372-.292.074.074 0 0 1 .077-.01c3.928 1.793 8.18 1.793 12.062 0a.074.074 0 0 1 .078.01c.12.098.246.198.373.292a.077.077 0 0 1-.006.127 12.299 12.299 0 0 1-1.873.892.077.077 0 0 0-.041.107c.36.698.772 1.362 1.225 1.993a.076.076 0 0 0 .084.028 19.839 19.839 0 0 0 6.002-3.03.077.077 0 0 0 .032-.054c.5-5.177-.838-9.674-3.549-13.66a.061.061 0 0 0-.031-.03zM8.02 15.33c-1.183 0-2.157-1.085-2.157-2.419 0-1.333.956-2.419 2.157-2.419 1.21 0 2.176 1.086 2.157 2.42 0 1.333-.956 2.418-2.157 2.418zm7.975 0c-1.183 0-2.157-1.085-2.157-2.419 0-1.333.955-2.419 2.157-2.419 1.21 0 2.176 1.086 2.157 2.42 0 1.333-.946 2.418-2.157 2.418z"/>
                                </svg>
                                Log in & Verify Membership
                            </a>
                            <p class="text-xs text-center text-slate-500 mt-2">Authenticates you and verifies KLM VA Server membership.</p>
                        </div>
                    `;
                }
            }
            
            updateDestinations();
        }

        function setDirection(dir) {
            currentDirection = dir;
            const btnOut = document.getElementById('btn-out');
            const btnIn = document.getElementById('btn-in');
            if(dir === 'out') {
                btnOut.className = "flex-1 py-2 border rounded font-bold text-sm bg-klm text-white border-klm transition";
                btnIn.className = "flex-1 py-2 border rounded font-bold text-sm bg-white text-slate-600 border-slate-300 transition";
            } else {
                btnOut.className = "flex-1 py-2 border rounded font-bold text-sm bg-white text-slate-600 border-slate-300 transition";
                btnIn.className = "flex-1 py-2 border rounded font-bold text-sm bg-klm text-white border-klm transition";
            }
            updateFlightDetails();
        }
        window.setDirection = setDirection;

        function updateDestinations() {
            const region = document.getElementById('region-select').value;
            const destSelect = document.getElementById('dest-select');
            if(routeData[region]) {
                bookingRouteList = routeData[region];
                destSelect.innerHTML = bookingRouteList.map((route, index) => 
                    `<option value="${index}">${route.city} (${route.code})</option>`
                ).join('');
                updateFlightDetails();
            }
        }
        window.updateDestinations = updateDestinations;
        
        // --- NEW: Toggle Custom Route Mode ---
        window.toggleCustomRoute = () => {
            const isCustom = document.getElementById('custom-route-toggle').checked;
            const standardControls = document.getElementById('standard-controls');
            const customControls = document.getElementById('custom-controls');
            
            if (isCustom) {
                standardControls.classList.add('hidden');
                customControls.classList.remove('hidden');
            } else {
                standardControls.classList.remove('hidden');
                customControls.classList.add('hidden');
            }
            window.updatePreview();
        };

        function updateFlightDetails() {
            const index = document.getElementById('dest-select').value;
            const flightSelect = document.getElementById('flight-select');
            const route = bookingRouteList[index];
            if (!route) return;
            if (currentDirection === 'out') {
                document.getElementById('disp-dep').textContent = "EHAM";
                document.getElementById('disp-arr').textContent = route.code;
            } else {
                document.getElementById('disp-dep').textContent = route.code;
                document.getElementById('disp-arr').textContent = "EHAM";
            }
            const rawString = currentDirection === 'out' ? route.out : route.in;
            const cleanString = rawString.replace(/[+*]/g, '');
            const numbers = cleanString.split(',').map(s => s.trim()).filter(s => s);
            flightSelect.innerHTML = numbers.map(num => `<option value="${num}">${num}</option>`).join('');
            updatePreview();
        }
        window.updateFlightDetails = updateFlightDetails;

        function updatePreview() {
            const isCustom = document.getElementById('custom-route-toggle') ? document.getElementById('custom-route-toggle').checked : false;
            let callsign, dep, arr;

            if (isCustom) {
                callsign = document.getElementById('custom-flight').value || '---';
                dep = document.getElementById('custom-dep').value || '---';
                arr = document.getElementById('custom-arr').value || '---';
                
                // Update the visual ticket display as well
                document.getElementById('disp-dep').textContent = dep === '---' ? '----' : dep;
                document.getElementById('disp-arr').textContent = arr === '---' ? '----' : arr;
            } else {
                callsign = document.getElementById('flight-select').value || '---';
                dep = document.getElementById('disp-dep').textContent;
                arr = document.getElementById('disp-arr').textContent;
            }

            const pilot = discordUser ? discordUser.username : '---';
            const ac = document.getElementById('aircraft-select').value || '---';
            const time = document.getElementById('dep-time').value || '--:--';
            
            document.getElementById('preview-callsign').textContent = callsign;
            document.getElementById('preview-dep').textContent = dep;
            document.getElementById('preview-arr').textContent = arr;
            document.getElementById('preview-pilot').textContent = pilot;
            document.getElementById('preview-ac').textContent = ac;
            document.getElementById('preview-time').textContent = time + 'z';
        }
        window.updatePreview = updatePreview;

        // --- SUBMIT TO FIREBASE (ASYNC) ---
        async function handleBookingSubmit(e) {
            e.preventDefault();
            const btn = e.target.querySelector('button[type="submit"]');
            const originalText = btn.innerHTML;
            
            if (!discordUser) { alert("You must log in with Discord first!"); return; }
            if (!discordUser.isMember) { alert("Access Denied: You must be a member of the KLM Virtual Airline Discord server to dispatch flights."); return; }

            btn.innerHTML = `<i data-lucide="loader" class="w-5 h-5 mr-2 animate-spin"></i> Processing...`;
            btn.disabled = true;

            const pilotName = discordUser.username;
            const aircraftType = document.getElementById('aircraft-select').value;
            const timeVal = document.getElementById('dep-time').value;
            
            // Check Custom Mode
            const isCustom = document.getElementById('custom-route-toggle').checked;
            
            let flightNumber, departure, destination;
            
            if (isCustom) {
                flightNumber = document.getElementById('custom-flight').value.toUpperCase();
                departure = document.getElementById('custom-dep').value.toUpperCase();
                destination = document.getElementById('custom-arr').value.toUpperCase();
                
                if (departure.length !== 4 || destination.length !== 4) {
                    alert("Please enter valid 4-letter ICAO codes for custom routes.");
                    btn.innerHTML = originalText;
                    btn.disabled = false;
                    return;
                }
            } else {
                flightNumber = document.getElementById('flight-select').value;
                destination = document.getElementById('disp-arr').textContent;
                departure = document.getElementById('disp-dep').textContent;
            }
            
            // CHECK TEST CHECKBOX
            const isTest = document.getElementById('is-test-flight').checked;
            const finalStatus = isTest ? "TEST" : "BOOKED";

            const selectedFleet = fleetData.find(f => f.type === aircraftType);
            const today = new Date();
            const [hours, minutes] = timeVal.split(':');
            today.setHours(hours, minutes, 0, 0);
            const scheduledDepartureISO = today.toISOString();

            if (!db) { alert("Database not connected."); btn.innerHTML = originalText; btn.disabled = false; return; }

            try {
                await addDoc(collection(db, "bookings"), {
                    flightNumber: flightNumber,
                    aircraft: { name: selectedFleet.type, icao: selectedFleet.icao },
                    departure: departure,
                    destination: destination,
                    pilot: { discordId: discordUser.id, callsign: pilotName, username: discordUser.username },
                    status: finalStatus, // Use determined status
                    scheduledDeparture: scheduledDepartureISO,
                    createdAt: serverTimestamp()
                });
                alert("Booking Confirmed!");
                router('home');
            } catch (error) {
                console.error("Error writing document: ", error);
                document.getElementById('db-error-banner').classList.remove('hidden');
                btn.innerHTML = originalText;
                btn.disabled = false;
            }
        }
        window.handleBookingSubmit = handleBookingSubmit;

        // --- DISPATCH BOARD (HOME) ---
        function initDispatchBoard() {
            const board = document.getElementById('dispatch-rows');
            if(!board || !db) return;
            // Status Color Map
            const statusColors = {
                'TEST': 'text-amber-400',
                'LOGGED': 'text-slate-500', // Gray for completed logs
                'BOOKED': 'text-emerald-400',
                'DEPARTED': 'text-sky-400',
                'ENROUTE': 'text-indigo-400',
                'ARRIVED': 'text-teal-400',
                'CANCELED': 'text-red-500'
            };

            const q = query(collection(db, "bookings"), orderBy("createdAt", "desc"), limit(20)); // Increased limit for scrolling
            dispatchUnsubscribe = onSnapshot(q, (querySnapshot) => {
                const statusLight = document.getElementById('db-status-light');
                const statusText = document.getElementById('db-status-text');
                const errorBanner = document.getElementById('db-error-banner');
                const boardEl = document.getElementById('dispatch-rows');
                if (statusLight) {
                    statusLight.classList.remove('bg-red-500', 'animate-pulse');
                    statusLight.classList.add('bg-emerald-500');
                    statusText.textContent = "SYSTEM ONLINE";
                    statusText.classList.remove('text-red-400');
                    statusText.classList.add('text-emerald-400');
                    if (errorBanner) errorBanner.classList.add('hidden');
                }
                if (boardEl) {
                    boardEl.innerHTML = "";
                    if(querySnapshot.empty) {
                        boardEl.innerHTML = '<div class="p-4 text-center text-slate-500">No active flights.</div>';
                        return;
                    }
                    querySnapshot.forEach((doc) => {
                        const data = doc.data();
                        const pilotName = data.pilot?.callsign || 'Unknown';
                        const flightNum = data.flightNumber || '---';
                        const aircraftName = data.aircraft?.name || '---';
                        const dest = data.destination || '---';
                        const status = data.status || 'BOOKED';
                        
                        // Handle Colors for Status
                        const statusColor = statusColors[status] || 'text-slate-200';

                        let dateStr = '--/--';
                        if (data.scheduledDeparture) {
                            try {
                                const date = new Date(data.scheduledDeparture);
                                // Format: 03 FEB
                                dateStr = date.toLocaleDateString('en-GB', {day: '2-digit', month: 'short'}).toUpperCase();
                            } catch (e) {}
                        }
                        const row = document.createElement('div');
                        row.className = 'fids-row';
                        row.innerHTML = `
                            <div class="font-bold text-klm truncate">${pilotName}</div>
                            <div>${flightNum}</div>
                            <div class="font-mono text-amber-500 font-bold">${dateStr}</div>
                            <div class="hidden md:block">EHAM ➝ ${dest}</div>
                            <div>${aircraftName}</div>
                            <div class="text-right font-bold uppercase ${statusColor} animate-pulse text-xs tracking-wider">${status}</div>
                        `;
                        boardEl.appendChild(row);
                    });
                }
            }, (error) => {
                const statusLight = document.getElementById('db-status-light');
                const statusText = document.getElementById('db-status-text');
                const errorBanner = document.getElementById('db-error-banner');
                if(errorBanner) errorBanner.classList.remove('hidden');
                if (statusLight) {
                    statusLight.classList.add('bg-red-500', 'animate-pulse');
                    statusText.textContent = "CONNECTION LOST";
                }
            });
        }

        // --- MAP LOGIC (UNCHANGED) ---
        let mapInstance = null;
        let flightLinesLayer = null;
        const routeManifest = [
          // EUROPE
          { "origin": "EHAM", "originCoords": [4.7639, 52.3091], "destination": "EGLL", "destinationCoords": [-0.4543, 51.4700], "fleet": ["E190", "E195", "B737-700", "B737-800", "A321neo"], "hub": true },
          { "origin": "EHAM", "originCoords": [4.7639, 52.3091], "destination": "LFPG", "destinationCoords": [2.5479, 49.0097], "fleet": ["E190", "E195", "B737-700", "B737-800", "A321neo"], "hub": true },
          { "origin": "EHAM", "originCoords": [4.7639, 52.3091], "destination": "EDDB", "destinationCoords": [13.5033, 52.3667], "fleet": ["E190", "E195", "B737-700", "B737-800", "A321neo"], "hub": true },
          { "origin": "EHAM", "originCoords": [4.7639, 52.3091], "destination": "LIRF", "destinationCoords": [12.2508, 41.8003], "fleet": ["B737-800", "A321neo"], "hub": true },
          { "origin": "EHAM", "originCoords": [4.7639, 52.3091], "destination": "LEMD", "destinationCoords": [-3.5668, 40.4893], "fleet": ["B737-800", "A321neo"], "hub": true },
          { "origin": "EHAM", "originCoords": [4.7639, 52.3091], "destination": "LOWW", "destinationCoords": [16.5697, 48.1103], "fleet": ["E190", "E195", "B737-800"], "hub": true },
          { "origin": "EHAM", "originCoords": [4.7639, 52.3091], "destination": "EBBR", "destinationCoords": [4.4844, 50.9014], "fleet": ["E190", "E195"], "hub": true },
          { "origin": "EHAM", "originCoords": [4.7639, 52.3091], "destination": "LSZH", "destinationCoords": [8.5492, 47.4581], "fleet": ["E190", "E195", "B737-800"], "hub": true },
          { "origin": "EHAM", "originCoords": [4.7639, 52.3091], "destination": "LSGG", "destinationCoords": [6.1092, 46.2370], "fleet": ["E190", "E195", "B737-800"], "hub": true },
          { "origin": "EHAM", "originCoords": [4.7639, 52.3091], "destination": "ESSA", "destinationCoords": [17.9186, 59.6519], "fleet": ["E190", "E195", "B737-800"], "hub": true },
          { "origin": "EHAM", "originCoords": [4.7639, 52.3091], "destination": "EKCH", "destinationCoords": [12.6560, 55.6180], "fleet": ["E190", "E195", "B737-800"], "hub": true },
          { "origin": "EHAM", "originCoords": [4.7639, 52.3091], "destination": "ENGM", "destinationCoords": [11.1004, 60.1939], "fleet": ["E190", "E195"], "hub": true },
          { "origin": "EHAM", "originCoords": [4.7639, 52.3091], "destination": "EFHK", "destinationCoords": [24.9633, 60.3172], "fleet": ["E190", "E195", "B737-800"], "hub": true },
          { "origin": "EHAM", "originCoords": [4.7639, 52.3091], "destination": "LGAV", "destinationCoords": [23.9445, 37.9364], "fleet": ["B737-800", "A321neo"], "hub": true },
          { "origin": "EHAM", "originCoords": [4.7639, 52.3091], "destination": "EVRA", "destinationCoords": [23.9711, 56.9236], "fleet": ["E195-E2"], "hub": true },
          { "origin": "EHAM", "originCoords": [4.7639, 52.3091], "destination": "EETN", "destinationCoords": [24.8328, 59.4133], "fleet": ["E195-E2"], "hub": true },
          { "origin": "EHAM", "originCoords": [4.7639, 52.3091], "destination": "EYVI", "destinationCoords": [25.2858, 54.6341], "fleet": ["E195-E2"], "hub": true },
          { "origin": "EHAM", "originCoords": [4.7639, 52.3091], "destination": "LPPR", "destinationCoords": [-8.6706, 41.2421], "fleet": ["B737-800"], "hub": true },
          { "origin": "EHAM", "originCoords": [4.7639, 52.3091], "destination": "LPPT", "destinationCoords": [-9.1359, 38.7742], "fleet": ["B737-800"], "hub": true },
          { "origin": "EHAM", "originCoords": [4.7639, 52.3091], "destination": "EPKK", "destinationCoords": [19.7848, 50.0777], "fleet": ["E195-E2"], "hub": true },
          { "origin": "EHAM", "originCoords": [4.7639, 52.3091], "destination": "EPWA", "destinationCoords": [20.9671, 52.1657], "fleet": ["E195-E2"], "hub": true },
          { "origin": "EHAM", "originCoords": [4.7639, 52.3091], "destination": "LKPR", "destinationCoords": [14.2632, 50.1008], "fleet": ["E195-E2"], "hub": true },
          { "origin": "EHAM", "originCoords": [4.7639, 52.3091], "destination": "LHBP", "destinationCoords": [19.2556, 47.4369], "fleet": ["B737-800"], "hub": true },
          { "origin": "EHAM", "originCoords": [4.7639, 52.3091], "destination": "LROP", "destinationCoords": [26.0850, 44.5711], "fleet": ["B737-800"], "hub": true },
          { "origin": "EHAM", "originCoords": [4.7639, 52.3091], "destination": "LFML", "destinationCoords": [5.2150, 43.4367], "fleet": ["B737-700"], "hub": true },
          { "origin": "EHAM", "originCoords": [4.7639, 52.3091], "destination": "LFMN", "destinationCoords": [7.2150, 43.6653], "fleet": ["B737-800"], "hub": true },

          // NORTH AMERICA
          { "origin": "EHAM", "originCoords": [4.7639, 52.3091], "destination": "KJFK", "destinationCoords": [-73.7781, 40.6413], "fleet": ["B787-9", "B787-10", "B777-300ER"], "hub": true },
          { "origin": "EHAM", "originCoords": [4.7639, 52.3091], "destination": "KATL", "destinationCoords": [-84.4277, 33.6407], "fleet": ["B787-9", "B777-300ER"], "hub": true },
          { "origin": "EHAM", "originCoords": [4.7639, 52.3091], "destination": "KLAX", "destinationCoords": [-118.4085, 33.9416], "fleet": ["B787-10", "B777-300ER"], "hub": true },
          { "origin": "EHAM", "originCoords": [4.7639, 52.3091], "destination": "KSFO", "destinationCoords": [-122.3790, 37.6213], "fleet": ["B787-9", "B787-10"], "hub": true },
          { "origin": "EHAM", "originCoords": [4.7639, 52.3091], "destination": "KORD", "destinationCoords": [-87.9073, 41.9742], "fleet": ["B787-9"], "hub": true },
          { "origin": "EHAM", "originCoords": [4.7639, 52.3091], "destination": "KBOS", "destinationCoords": [-71.0052, 42.3656], "fleet": ["B787-9"], "hub": true },
          { "origin": "EHAM", "originCoords": [4.7639, 52.3091], "destination": "KIAD", "destinationCoords": [-77.4565, 38.9531], "fleet": ["B787-9"], "hub": true },
          { "origin": "EHAM", "originCoords": [4.7639, 52.3091], "destination": "KIAH", "destinationCoords": [-95.3414, 29.9844], "fleet": ["B787-9"], "hub": true },
          { "origin": "EHAM", "originCoords": [4.7639, 52.3091], "destination": "CYYZ", "destinationCoords": [-79.6248, 43.6777], "fleet": ["B777-300ER", "B787-10"], "hub": true },
          { "origin": "EHAM", "originCoords": [4.7639, 52.3091], "destination": "CYUL", "destinationCoords": [-73.7408, 45.4706], "fleet": ["A330-200"], "hub": true },
          { "origin": "EHAM", "originCoords": [4.7639, 52.3091], "destination": "CYYC", "destinationCoords": [-114.0203, 51.1139], "fleet": ["B787-9"], "hub": true },
          { "origin": "EHAM", "originCoords": [4.7639, 52.3091], "destination": "CYVR", "destinationCoords": [-123.1840, 49.1947], "fleet": ["B777-300ER"], "hub": true },
          { "origin": "EHAM", "originCoords": [4.7639, 52.3091], "destination": "MMMX", "destinationCoords": [-99.0721, 19.4363], "fleet": ["B787-9"], "hub": true },

          // SOUTH AMERICA
          { "origin": "EHAM", "originCoords": [4.7639, 52.3091], "destination": "SBGR", "destinationCoords": [-46.4731, -23.4356], "fleet": ["B777-300ER", "B787-9"], "hub": true },
          { "origin": "EHAM", "originCoords": [4.7639, 52.3091], "destination": "SAEZ", "destinationCoords": [-58.5358, -34.8222], "fleet": ["B777-300ER"], "hub": true },
          { "origin": "EHAM", "originCoords": [4.7639, 52.3091], "destination": "SBGL", "destinationCoords": [-43.2506, -22.8089], "fleet": ["B787-9"], "hub": true },
          { "origin": "EHAM", "originCoords": [4.7639, 52.3091], "destination": "SKBO", "destinationCoords": [-74.1469, 4.7016], "fleet": ["B787-9"], "hub": true },
          { "origin": "EHAM", "originCoords": [4.7639, 52.3091], "destination": "SPJC", "destinationCoords": [-77.1143, -12.0219], "fleet": ["B777-300ER"], "hub": true },
          { "origin": "EHAM", "originCoords": [4.7639, 52.3091], "destination": "SEQM", "destinationCoords": [-78.3586, -0.1292], "fleet": ["B777-200ER"], "hub": true },
          { "origin": "EHAM", "originCoords": [4.7639, 52.3091], "destination": "SEGU", "destinationCoords": [-79.8836, -2.1575], "fleet": ["B777-200ER"], "hub": true },
          { "origin": "EHAM", "originCoords": [4.7639, 52.3091], "destination": "SMJP", "destinationCoords": [-55.1878, 5.4528], "fleet": ["B777-300ER"], "hub": true },
          { "origin": "EHAM", "originCoords": [4.7639, 52.3091], "destination": "TNCA", "destinationCoords": [-70.0152, 12.5014], "fleet": ["A330-200"], "hub": true },
          { "origin": "EHAM", "originCoords": [4.7639, 52.3091], "destination": "TNCM", "destinationCoords": [-63.1089, 18.0410], "fleet": ["A330-200"], "hub": true },
          { "origin": "EHAM", "originCoords": [4.7639, 52.3091], "destination": "TNCC", "destinationCoords": [-68.9597, 12.1889], "fleet": ["B777-300ER"], "hub": true },
          { "origin": "EHAM", "originCoords": [4.7639, 52.3091], "destination": "TNCB", "destinationCoords": [-68.2685, 12.1310], "fleet": ["A330-200"], "hub": true },

          // ASIA
          { "origin": "EHAM", "originCoords": [4.7639, 52.3091], "destination": "RJAA", "destinationCoords": [140.3929, 35.7719], "fleet": ["B787-9", "B777-300ER"], "hub": true },
          { "origin": "EHAM", "originCoords": [4.7639, 52.3091], "destination": "RJBB", "destinationCoords": [135.2304, 34.4320], "fleet": ["B787-9"], "hub": true },
          { "origin": "EHAM", "originCoords": [4.7639, 52.3091], "destination": "VHHH", "destinationCoords": [113.9146, 22.3080], "fleet": ["B777-300ER"], "hub": true },
          { "origin": "EHAM", "originCoords": [4.7639, 52.3091], "destination": "WSSS", "destinationCoords": [103.9940, 1.3644], "fleet": ["B787-10", "B777-300ER"], "hub": true },
          { "origin": "EHAM", "originCoords": [4.7639, 52.3091], "destination": "RKSI", "destinationCoords": [126.4407, 37.4602], "fleet": ["B787-9"], "hub": true },
          { "origin": "EHAM", "originCoords": [4.7639, 52.3091], "destination": "VIDP", "destinationCoords": [77.1000, 28.5562], "fleet": ["B787-10"], "hub": true },
          { "origin": "EHAM", "originCoords": [4.7639, 52.3091], "destination": "VABB", "destinationCoords": [72.8656, 19.0896], "fleet": ["B787-10"], "hub": true },
          { "origin": "EHAM", "originCoords": [4.7639, 52.3091], "destination": "VOBL", "destinationCoords": [77.7066, 13.1986], "fleet": ["B777-200ER"], "hub": true },
          { "origin": "EHAM", "originCoords": [4.7639, 52.3091], "destination": "ZBAA", "destinationCoords": [116.5871, 40.0801], "fleet": ["B777-300ER"], "hub": true },
          { "origin": "EHAM", "originCoords": [4.7639, 52.3091], "destination": "ZSPD", "destinationCoords": [121.8052, 31.1443], "fleet": ["B777-300ER"], "hub": true },
          { "origin": "EHAM", "originCoords": [4.7639, 52.3091], "destination": "VTBS", "destinationCoords": [100.7501, 13.6900], "fleet": ["B777-300ER"], "hub": true },
          { "origin": "EHAM", "originCoords": [4.7639, 52.3091], "destination": "WMKK", "destinationCoords": [101.7099, 2.7456], "fleet": ["B787-9"], "hub": true },
          { "origin": "EHAM", "originCoords": [4.7639, 52.3091], "destination": "WIII", "destinationCoords": [106.6559, -6.1256], "fleet": ["B777-300ER"], "hub": true },
          { "origin": "EHAM", "originCoords": [4.7639, 52.3091], "destination": "RPLL", "destinationCoords": [121.0194, 14.5086], "fleet": ["B777-300ER"], "hub": true },
          { "origin": "EHAM", "originCoords": [4.7639, 52.3091], "destination": "RCTP", "destinationCoords": [121.2313, 25.0777], "fleet": ["B777-300ER"], "hub": true },
          { "origin": "EHAM", "originCoords": [4.7639, 52.3091], "destination": "WADD", "destinationCoords": [115.1668, -8.7482], "fleet": ["B777-300ER"], "hub": true },

          // MIDDLE EAST
          { "origin": "EHAM", "originCoords": [4.7639, 52.3091], "destination": "OMDB", "destinationCoords": [55.3644, 25.2532], "fleet": ["B787-9", "B777-300ER"], "hub": true },
          { "origin": "EHAM", "originCoords": [4.7639, 52.3091], "destination": "LLBG", "destinationCoords": [34.8854, 32.0114], "fleet": ["B737-900"], "hub": true },
          { "origin": "EHAM", "originCoords": [4.7639, 52.3091], "destination": "OMAA", "destinationCoords": [54.6511, 24.4330], "fleet": ["B787-9"], "hub": true },
          { "origin": "EHAM", "originCoords": [4.7639, 52.3091], "destination": "OKBK", "destinationCoords": [47.9689, 29.2266], "fleet": ["A330-200"], "hub": true },
          { "origin": "EHAM", "originCoords": [4.7639, 52.3091], "destination": "OTHH", "destinationCoords": [51.6083, 25.2731], "fleet": ["B777-300ER"], "hub": true },
          { "origin": "EHAM", "originCoords": [4.7639, 52.3091], "destination": "OERK", "destinationCoords": [46.6989, 24.9576], "fleet": ["A330-200"], "hub": true },
          { "origin": "EHAM", "originCoords": [4.7639, 52.3091], "destination": "HECA", "destinationCoords": [31.4056, 30.1219], "fleet": ["B777-200ER"], "hub": true },

          // AFRICA
          { "origin": "EHAM", "originCoords": [4.7639, 52.3091], "destination": "HKJK", "destinationCoords": [36.9275, -1.3192], "fleet": ["B787-10"], "hub": true },
          { "origin": "EHAM", "originCoords": [4.7639, 52.3091], "destination": "HTDA", "destinationCoords": [39.2026, -6.8781], "fleet": ["B787-10"], "hub": true },
          { "origin": "EHAM", "originCoords": [4.7639, 52.3091], "destination": "FAOR", "destinationCoords": [28.2411, -26.1367], "fleet": ["B777-300ER"], "hub": true },
          { "origin": "EHAM", "originCoords": [4.7639, 52.3091], "destination": "FACT", "destinationCoords": [18.6017, -33.9715], "fleet": ["B777-300ER"], "hub": true },
          { "origin": "EHAM", "originCoords": [4.7639, 52.3091], "destination": "DGAA", "destinationCoords": [-0.1667, 5.6052], "fleet": ["B777-300ER"], "hub": true },
          { "origin": "EHAM", "originCoords": [4.7639, 52.3091], "destination": "DNMM", "destinationCoords": [3.3212, 6.5774], "fleet": ["A330-200"], "hub": true },
          { "origin": "EHAM", "originCoords": [4.7639, 52.3091], "destination": "HRYR", "destinationCoords": [30.1331, -1.9686], "fleet": ["A330-200"], "hub": true },
          { "origin": "EHAM", "originCoords": [4.7639, 52.3091], "destination": "HUEN", "destinationCoords": [32.4431, 0.0450], "fleet": ["A330-200"], "hub": true }
        ];

        function initFleetMap() {
            const container = document.getElementById('fleet-map');
            if (!container) return;
            if (mapInstance) { mapInstance.remove(); mapInstance = null; }
            mapInstance = L.map('fleet-map', { center: [30, 0], zoom: 2, minZoom: 2, maxBounds: [[-90, -180], [90, 180]], zoomControl: false, attributionControl: false });
            L.tileLayer('https://{s}.basemaps.cartocdn.com/dark_all/{z}/{x}/{y}{r}.png', { subdomains: 'abcd', maxZoom: 19 }).addTo(mapInstance);
            flightLinesLayer = L.layerGroup().addTo(mapInstance);
            filterMapRoutes('ALL');
        }

        function filterMapRoutes(aircraftType) {
            if (!flightLinesLayer) return;
            flightLinesLayer.clearLayers();
            const hubIcon = L.divIcon({ className: 'custom-div-icon', html: "<div style='background-color:#00A1DE;width:8px;height:8px;border-radius:50%;box-shadow:0 0 15px #00A1DE;'></div>", iconSize: [8, 8], iconAnchor: [4, 4] });
            L.marker([52.3091, 4.7639], { icon: hubIcon }).addTo(flightLinesLayer);
            routeManifest.forEach(route => {
                const start = [route.originCoords[1], route.originCoords[0]];
                const end = [route.destinationCoords[1], route.destinationCoords[0]];
                const latlngs = getCurvePoints(start, end);
                const polyline = L.polyline(latlngs, { color: '#00A1DE', weight: 1, opacity: 0.4, smoothFactor: 1 });
                polyline.addTo(flightLinesLayer);
                L.circleMarker(end, { radius: 2, fillColor: '#fff', color: '#00A1DE', weight: 0, opacity: 1, fillOpacity: 0.8 }).addTo(flightLinesLayer);
            });
        }

        function getCurvePoints(start, end) {
            const lat1 = start[0], lng1 = start[1], lat2 = end[0], lng2 = end[1];
            const midLat = (lat1 + lat2) / 2, midLng = (lng1 + lng2) / 2;
            const dist = Math.sqrt(Math.pow(lat2 - lat1, 2) + Math.pow(lng2 - lng1, 2));
            const controlLat = midLat + (dist * 0.25), controlLng = midLng; 
            const points = [];
            for(let t=0; t<=1; t+=0.02) {
                const invT = 1 - t;
                const lat = (invT * invT * lat1) + (2 * invT * t * controlLat) + (t * t * lat2);
                const lng = (invT * invT * lng1) + (2 * invT * t * controlLng) + (t * t * lng2);
                points.push([lat, lng]);
            }
            points.push([lat2, lng2]); 
            return points;
        }

        function renderRouteGrid(region) {
            const grid = document.getElementById('route-grid');
            const data = routeData[region] || [];
            document.querySelectorAll('.route-btn').forEach(btn => {
                if(btn.id === `btn-${region}`) { btn.classList.add('bg-klm', 'text-white'); btn.classList.remove('bg-white', 'text-slate-600'); }
                else { btn.classList.remove('bg-klm', 'text-white'); btn.classList.add('bg-white', 'text-slate-600', 'border', 'border-slate-200'); }
            });
            grid.innerHTML = data.map(route => `
                <div class="bg-white p-4 rounded border border-slate-200 hover:border-klm transition">
                    <div class="flex justify-between items-center mb-2">
                        <span class="font-bold text-slate-800 text-sm truncate">${route.city}</span>
                        <span class="font-mono text-xs text-slate-400">${route.code}</span>
                    </div>
                    <div class="flex flex-col gap-1 text-[10px] font-mono text-slate-500">
                         <div class="bg-slate-100 px-1 rounded truncate" title="${route.out}">OUT: ${route.out}</div>
                         <div class="bg-slate-100 px-1 rounded truncate" title="${route.in}">IN: ${route.in}</div>
                    </div>
                </div>
            `).join('');
        }
        window.renderRouteGrid = renderRouteGrid;

        function toggleMobileMenu() { document.getElementById('mobile-menu').classList.toggle('hidden'); }
        window.toggleMobileMenu = toggleMobileMenu;

        document.getElementById('nav-logo').src = siteImages.logo;
        router('home');
    </script>
</body>
</html>
